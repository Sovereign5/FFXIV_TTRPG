<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css?family=Bebas+Neue&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Romanesco&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Jura:wght@300..700&display=swap" rel="stylesheet">

<input type="text" name="attr_char_modifier" hidden>
<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab"  value="character"  />
<div class="sheetTabs">
    <button type="action" name="act_character" >Character</button>
    <button type="action" name="act_abilities" >Abilites</button>
</div>

<div class="sheet-mainpage">
	<div class="headerbar">
		<img src="https://raw.githubusercontent.com/Sovereign5/FFXIV_TTRPG/main/images/logo_text.png" />
		<div class="headerbar-right">
			<input type="text" name="attr_character_name" style="position: relative; font-size: 24px; font-family: Jura; background-color: transparent; appearance: none; border: none; color: white; width: 255px;">
			<hr style="width: 255px; position: relative; right: 150px; bottom: 24px; border-top: 2px solid white;">
		</div>
	</div>

	<!-- ROLE BAR + HP + MP -->
	<div class="rolebar">
		<div class="rolebar-left">
			<!-- ROLE SELECTION -->
			<div class="stacking-element-font" style="position: relative; top: 8px">
				<span style="position: relative; right: 60px">ROLE</span>
				<span style="position: relative; left: 15px;">JOB</span>
			</div>
			<div>
				<span style="position: relative; font-size: 20px;">LV</span>
				<input type="number" name="attr_char_level" step="10" min="0" max="50" style="position: relative; bottom: 6px; text-decoration: underline;">
				<select name="attr_class" style="position: relative; width: 280px; height: 40px; font-size: 24px; font-weight: 600;">
					<option style="color: black;" value="-1">Select</option>
					<option style="color: black;" value="Paladin">Tank / Paladin</option>
					<option style="color: black;" value="Warrior">Tank / Warrior</option>
					<option style="color: black;" value="DarkKnight">Tank / Dark Knight</option>
					<option style="color: black;" value="Gunbreaker">Tank / Gunbreaker</option>
					<option style="color: black;" value="WhiteMage">Healer / White Mage</option>
					<option style="color: black;" value="Scholar">Healer / Scholar</option>
					<option style="color: black;" value="Astrologian">Healer / Astrologian</option>
					<option style="color: black;" value="Sage">Healer / Sage</option>
					<option style="color: black;" value="Monk">DPS / Monk</option>
					<option style="color: black;" value="Dragoon">DPS / Dragoon</option>
					<option style="color: black;" value="Ninja">DPS / Ninja</option>
					<option style="color: black;" value="Samurai">DPS / Samurai</option>
					<option style="color: black;" value="Reaper">DPS / Reaper</option>
					<option style="color: black;" value="Bard">DPS / Bard</option>
					<option style="color: black;" value="Machinist">DPS / Machinist</option>
					<option style="color: black;" value="Dancer">DPS / Dancer</option>
					<option style="color: black;" value="BlackMage">DPS / Black Mage</option>
					<option style="color: black;" value="Summoner">DPS / Summoner</option>
					<option style="color: black;" value="RedMage">DPS / Red Mage</option>
					<option style="color: black;" value="BlueMage">DPS / Blue Mage</option>
				</select>
			</div>
			
		</div>

		<div class="rolebar-middle">
			<!-- HP BAR -->
			<span style="font-size: 2em; position: relative; left: 18px">HP</span>
			<input type="number" name="attr_char_HP" min="0" style="position: relative; left: 18px; width: 80px; height: 60px; font-size: 50px;">
			<span class="dividing-line" style="position: relative;">/</span>
			<div class="stacking-element">
				<span class="stacking-element-font" style="position: relative; right: 8px">MAX</span>
				<input type="number" name="attr_char_maxHP" min="0" style="position: relative; left: 2px">
			</div>
			<span class="dividing-line" style="position: relative; right: 13px">|</span>
			<div class="stacking-element">
				<span class="stacking-element-font" style="position: relative; right: 12px">BARRIER</span>
				<input type="number" name="attr_char_tempHP" min="0" style="position: relative; left: 5px;">
			</div>
		</div>

		<div class="rolebar-right">
			<!-- MP BAR -->
			<span style="font-size: 2em;">MP</span>
			<input type="number" name="attr_char_MP" min="0" max="5" style="position: relative; width: 45px; height: 60px; font-size: 50px;"/>
			<span class="dividing-line" style="position: relative; right: 13px">/</span>
			<div class="stacking-element" style="position: relative; right: 5px">
				<span class="stacking-element-font">MAX</span>
				<span>5</span>
			</div>
		</div>
	</div>
	<!-- END OF ROLE BAR + HP + MP -->

	<!-- THE BODY -->
	<div class="body">
		<div class="body-left">
			<div class="grid-item" style="position: relative; top: 13px;">
				<label>Main Status</label>
				<hr style="position: relative; bottom: 19px;">
			</div>
			<div class="grid-item" style="position: relative; top: 13px;">
				<label>Sub Status</label>
				<hr style="position: relative; bottom: 19px; width: 88%; right: 10px;">
			</div>
			<div class="grid-item">
				<div class="grid-rollable">
					<span>STR</span>
					<input type="number" name="attr_char_strength">
					<button type='roll' value="&{template:ffxivmain} {{header=attribute}} {{name=Strength}} {{check=Attribute Check}} {{Attribute=[[1d20 + @{char_strength}]] }}" name=roll_strCheck></button>
					<hr>
				</div>
			</div>
			<div class="grid-item">
				<span class="span-longer">Defense</span>
				<input class="input-shorter" type="number" name="attr_physical_defense" value="10">
				<hr style="width: 88%; position: relative; right: 10px; bottom: 25px;">
			</div>
			<div class="grid-item">
				<div class="grid-rollable">
					<span>DEX</span>
					<input type="number" name="attr_char_dexterity">
					<button type='roll' value="&{template:ffxivmain} {{header=attribute}} {{name=Dexterity}} {{check=Attribute Check}} {{Attribute=[[1d20 + @{char_dexterity}]] }}" name=roll_dexCheck></button>
					<hr>
				</div>
			</div>
			<div class="grid-item">
				<span class="span-longer">M. Defense</span>
				<input class="input-shorter" type="number" name="attr_magical_defense" value="10">
				<hr style="width: 88%; position: relative; right: 10px; bottom: 25px;">
			</div>
			<div class="grid-item">
				<div class="grid-rollable">
					<span>VIT</span>
					<input type="number" name="attr_char_vitality">
					<button type='roll' value="&{template:ffxivmain} {{header=attribute}} {{name=Vitality}} {{check=Attribute Check}} {{Attribute=[[1d20 + @{char_vitality}]] }}" name=roll_vitCheck></button>
					<hr>
				</div>
			</div>
			<div class="grid-item">
				<span class="span-longer">Vigilance</span>
				<input class="input-shorter" type="number" name="attr_char_vigilance" />
				<hr style="width: 88%; position: relative; right: 10px; bottom: 25px;">
			</div>
			<div class="grid-item">
				<div class="grid-rollable">
					<span>INT</span>
					<input type="number" name="attr_char_intelligence">
					<button type='roll' value="&{template:ffxivmain} {{header=attribute}} {{name=Intelligence}} {{check=Attribute Check}} {{Attribute=[[1d20 + @{char_intelligence}]] }}" name=roll_intCheck></button>
					<hr>
				</div>
			</div>
			<div class="grid-item">
				<span class="span-longer" style="width: 55px">Speed</span>
				<input type="number" name="attr_speed" value="5" placeholder="5" step="1" class="input-shorter" required>
				<span class="input-shorter" style="font-size: 14px; position: relative; right:15px">squares</span>
				<hr style="width: 88%; position: relative; right: 10px; bottom: 24px;">
			</div>
			<div class="grid-item">
				<div class="grid-rollable">
					<span>MND</span>
					<input type="number" name="attr_char_mind">
					<button type='roll' value="&{template:ffxivmain} {{header=attribute}} {{name=Mind}} {{check=Attribute Check}} {{Attribute=[[1d20 + @{char_mind}]] }}" name=roll_mndCheck></button>
					<hr>
				</div>
			</div>
			<!-- Purposefully Left Empty for Spacing -->
			<div class="grid-item"></div>
		</div>
		<div class="body-right">
			<label>Traits & Other Effects</label>
			<fieldset class="repeating_traits">
				<div class="traitdiv">
					<input type="checkbox" name="attr_traitswitch" class="sheet-traits-switch" value="1" hidden>
					<button type="action" name="act_traitedit" class="edittraitbutton"><span style="font-family:Pictos;">y</span></button>
					<div class="sheet-traits-hide">
						<span>Name:</span> <input type="text" name="attr_traitname"><br>
						<span>Effect:</span> <input type="text" name="attr_traiteffect"><br>
						<span>Description</span>
					<textarea name="attr_traitdescription"></textarea>
					</div>



					<div class="sheet-traits-show">
						<div class="traits-headerbar" style="display: flex;">
							<div style="width: 48%;">
								<button type='roll' value="&{template:info} {{name=@{traitname} }} {{trait=@{traiteffect} }} {{desc=@{traitdescription} }}" name="roll_traitdisplay" style="position: relative; top: -2px;" class="traitdisplay"><span name="attr_traitname" style="text-align: right; width: 50%;"></span>
								</button>
							</div>
							<div style="width: 48%; text-align: right;">
								<span name="attr_traiteffect"></span>
							</div>
						</div>
						<span name="attr_traitdescription"></span>
					</div>	
				</div>
			</fieldset>
		</div>
	</div>
</div>




<!-- SECOND PAGE - ABILITIES -->
<div class=sheet-abilitiespage>
	<div class=ability-limitbreak>
		<label>LIMIT BREAK</label>
		<input type="checkbox" name="attr_limitbreakTargetCheckbox" class="sheet-limitbreaktargetcheckbox" hidden>
		<input type="checkbox" name="attr_limitbreakRangeCheckbox" class="sheet-limitbreakrangecheckbox" hidden>
		<div>
			<!-- GLOBAL VARIABLES LIMIT BREAK --> 
			<input type="checkbox" name="attr_limitbreakswitch" class="sheet-limitbreak-switch" value="0" hidden>
			<input type="checkbox" name="attr_limitbreakcollapse" class="sheet-limitbreakcollapse" value="0" hidden>
			<button type="action" name="act_limitbreakedit" class="editlimitbreakbutton"><span style="font-family:Pictos; z-index: 99;">y</span></button>
			<button type="action" class="toggle_limitbreakcollapse" name="act_collapse"><span style="font-family:Pictos; z-index: 99;">w</button><br>
			<input type="text" name="attr_limitbreakRollValue" value="" hidden>


			<!-- DISPLAY MODE LIMIT BREAK -->
			<div class="sheet-limitbreak-a">
				<button type="roll" class="sheet-diceroll" style="font-size: 2em; width: 400px; text-align: left;" value="@{limitbreakRollValue}" name="roll_limitbreakdie"> <span name="attr_limitbreakName"></span> </button><br>
				<span name="attr_limitbreakTags" style="font-style: italic;"></span>
				
				<!-- Trigger -->
				<input type="checkbox" name="attr_limitbreaktrigger_show" class="sheet-limitbreaktriggershow" hidden>
				<div class="sheet-limitbreaktrigger">
					<span style="font-weight: 700;">Trigger:&nbsp;</span>
					<span name="attr_limitbreaktrigger_display"></span>
				</div>

				<!-- Target -->
				<input type="checkbox" name="attr_limitbreaktarget_show" class="sheet-limitbreaktargetshow" hidden>
				<div class="sheet-limitbreaktarget">
					<span style="font-weight: 700;">Target:&nbsp;</span>
					<span name="attr_limitbreaktarget_display"></span>
				</div>

				<!-- Range -->
				<input type="checkbox" name="attr_limitbreakrange_show" class="sheet-limitbreakrangeshow" hidden>
				<div class="sheet-limitbreakrange">
					<span style="font-weight: 700;">Range:&nbsp;</span>
					<span name="attr_limitbreakrange_display"></span>
				</div>

				<!-- Base Effect -->
				<input type="checkbox" name="attr_limitbreakbaseeffect_show" class="sheet-limitbreakbaseeffectshow" hidden>
				<div class="sheet-limitbreakbaseeffect">
					<span style="font-weight: 700;">Base Effect:&nbsp;</span>
					<span name="attr_limitbreakbaseeffect_display"></span>
				</div>

				<!-- Base Effect Dice -->
				<!-- <input type="checkbox" name="attr_limitbreakbaseeffectdie_show" class="sheet-limitbreakbaseeffectdieshow" hidden>
				<div class="sheet-limitbreakbaseeffectdie">
					<span style="font-weight: 700;">Base Effect Die:&nbsp;</span>
					<span name="attr_limitbreakbaseeffectdie_display"></span>
				</div> -->
			</div>

			<!-- COLLAPSE MODE LIMIT BREAK -->
			<div class="sheet-limitbreak-c" style="position: absolute;">
				<!-- TODO: SET THIS TO 'main' FOR RELEASE, OFF OF BETA -->
				<img src="https://raw.githubusercontent.com/Sovereign5/FFXIV_TTRPG/beta/images/Limitbreak_icon.png" class="limitbreak-image" style="position: absolute; top: -44px; left: 130px;">
				<button type="roll" class="sheet-diceroll-collapsed" style="font-size: 2em; width: 400px; position: absolute; top: -42px; left: 176px" value="@{limitbreakRollValue}" name="roll_limitbreakdie"> <span name="attr_limitbreakName"></span> </button><br>
				<span name="attr_limitbreakTags" class="sheet-limitbreaktags-collapse" style="position: absolute; top: -20px; left: 186px; width: 300px;"></span>
			</div>


			<!-- EDIT MODE LIMIT BREAK -->
			<div class="sheet-limitbreak-b">
				<span>Name: </span> <input type="text" name="attr_limitbreakName" style="width: 780px;" ><br>
				<span>Tags: </span> <input type="text" name="attr_limitbreakTags" style="width: 780px;"><br>
				<span>Trigger: </span> <input type="text" name="attr_limitbreakTrigger"><br>

				<span>Target: </span>
				<input type="text" name="attr_limitbreakTarget"><br>

				<span>Range: </span> 
				<input type="text" name="attr_limitbreakRange"><br>

				<span> Base Effect: </span> <textarea name="attr_limitbreakBaseEffect" style="width: 800px;"></textarea><br>

				<span>Base Effect Dice: </span>
				<input type="text" name="attr_limitbreakBaseEffectDie" style="width: 200px;" >
				<span>&nbsp;</span>
				<select name="attr_limitbreakDamageOrHealing">
					<option value="damage" selected>Damage</option>
					<option value="healing">Healing</option>
				</select>
				<span></span>
			</div>
		</div>
	</div>

	<div class="sheet-abilities">
		<div class=abilities-primary>
			<label>PRIMARY ABILITIES</label>
			<fieldset class=repeating_primaryability>
				<input type="checkbox" class="sheet-block-switch" name="attr_blockswitch" value="1" hidden>
				<input type="checkbox" class="sheet-block-collapse" name="attr_blockcollapse" value="1" hidden>
				<input type="text" name="attr_abilityRollValue" value="" hidden>
				

				<button type="action" class="toggle_repeating_npcaction_edit" name="act_edit"><span style="font-family:Pictos;">y</button><br>
				<button type="action" class="toggle_collapse" name="act_collapse"><span style="font-family:Pictos;">w</button><br>

				<!-- EDITING MODE - PRIMARY ABILITIES -->
				<div class="sheet-block-a" style="padding: 3px;">
					<span>Ability Name</span>
					<input type="text" name="attr_abilityname" placeholder="Storm's Path" required>
					<br>

					<span>Ability Tags</span>
					<input type="text" name="attr_abilitytags" placeholder="Primary, Physical">
					<br>

					<span>Limitation</span>
					<select name="attr_limitation">
						<option value="" selected>No Limitation</option>
						<option value="1">Once per phase</option>
						<option value="2">Two times per phase</option>
						<option value="3">Three times per phase</option>
					</select>
					<br>

					<span>Requirement</span>
					<input type="text" name="attr_abilityrequirement">
					<br>
					<span>Trigger</span>
					<input type="text" name="attr_abilitytrigger" placeholder="When an enemy within 10 squares begins their turn.">
					<br>

					<span>Cost</span>
					<input type="text" name="attr_abilitycost" placeholder="1 MP">
					<br>

					<span>Target</span>
					<input type="text" name="attr_abilitytarget" placeholder="Single">
					<br>

					<span>Range</span>
					<input type="text" name="attr_abilityrange" placeholder="5 Squares">
					<br>

					<span>Check</span>
					<select class="sheet-checkcheckbox" name="attr_abilitycheck">
						<option value="" selected="selected">No Check</option>
						<option value="1d20">Special</option>
						<option value="1d20 + @{char_strength}">STR</option>
						<option value="1d20 + @{char_dexterity}">DEX</option>
						<option value="1d20 + @{char_vitality}">VIT</option>
						<option value="1d20 + @{char_intelligence}">INT</option>
						<option value="1d20 + @{char_mind}">MND</option>
					</select>
					<br>
					<span>CR</span>
					<input type="text" name="attr_abilitycr" placeholder="Target's Defense">
					<br>
					<span>Base Effect</span>
					<input type="text" name="attr_abilitybaseeffect" placeholder="Deals 3 damage to the target" required>
					<br>

					<span>Base Effect</span>
					<div style="display: flex;">
						<input type="text" name="attr_abilitybaseeffectdamage" placeholder="1d6" style="width: 70px;" required>
						<span>&nbsp;</span>
						<select name="attr_abilitybaseeffectdamageorhealing">
							<option value="Damage">Damage</option>
							<option value="Healing">Healing</option>
						</select>
					</div>
					<br>

					<span>Base Effect Extra Effect</span>
					<input type="text" name="attr_abilitybaseeffectextraeffect" placeholder="Combo: Storm's Path">
					<br>

					<span>Direct Hit</span>
					<input type="text" name="attr_abilitydirecthit" placeholder="Deals an additional 2d6 damage">
					<br>

					<span>Direct Hit Damage</span>
					<div style="display: flex;">
						<input type="text" name="attr_abilitydirecthitdamage" placeholder="2d6" style="width: 70px;" required>
						<span>&nbsp;</span>
						<select name="attr_abilitydirecteffectdamageorhealing">
							<option value="Damage">Damage</option>
							<option value="Healing">Healing</option>
						</select>
					</div>
					<br>

					<span>Direct Hit Extra Effect</span>
					<input type="text" name="attr_abilitydirecthitextraeffect" placeholder="Generates Emnity">
				</div>

				<!-- DISPLAY MODE - PRIMARY ABILITIES -->
				<div class="sheet-block-b" style="padding: 3px;">
					<div style="display: flex;">
						<button type="roll" class="sheet-diceroll" value="@{abilityRollValue}" name="roll_abilityCheck" style="width: 70%; text-align: left;"> <span name="attr_abilityname"></span> </button><br>

						<!-- Limitation -->
						<input type="checkbox" name="attr_limitation_show" class="sheet-limitationshow" hidden>
						<div class="sheet-limitation" style="text-align: right; width: 30%;">
							<input dir="rtl" type="number" name="attr_limitationamount" value="0" class="input-shorter" style="position: relative; left: 17px; top: -2px; width: 80%; vertical-align: top;">
							<span name="attr_limitation_display" class="input-shorter" style="margin: auto;"></span>
						</div>
					</div>
					<!-- Tags -->
					<span name="attr_abilitytags_display" style="font-style: italic;"></span><br>

					<!-- Trigger -->
					<input type="checkbox" name="attr_trigger_show" class="sheet-triggershow" hidden>
					<div class="sheet-trigger">
						<span style="font-weight: 700;">Trigger:&nbsp;</span>
						<span name="attr_abilitytrigger_display"></span>
					</div>

					<!-- Requirement -->
					<input type="checkbox" name="attr_abilityrequirement_show" class="sheet-requirementshow" hidden>
					<div class="sheet-requirement">
						<span style="font-weight: 700;">Requirement:&nbsp;</span>
						<span name="attr_abilityrequirement_display"></span>
					</div>

					<!-- Target -->
					<input type="checkbox" name="attr_abilitytarget_show" class="sheet-targetshow" hidden>
					<div class="sheet-target">
						<span style="font-weight: 700;">Target:&nbsp;</span>
						<span name="attr_target_display"></span>
					</div>

					<!-- Cost -->
					<input type="checkbox" name="attr_abilitycost_show" class="sheet-costshow" hidden>
					<div class="sheet-cost">
						<span style="font-weight: 700;">Cost:&nbsp;</span>
						<span name="attr_abilitycost_display"></span>
					</div>

					<!-- Range -->
					<input type="checkbox" name="attr_range_show" class="sheet-rangeshow" hidden>
					<div class="sheet-range">
						<span style="font-weight: 700;">Range:&nbsp;</span>
						<span name="attr_range_display"></span>
					</div>

					<!-- Check -->
					<input type="checkbox" name="attr_abilitycheck_show" class="sheet-abilitycheckshow" hidden>
					<div class="sheet-abilitycheck">
						<span style="font-weight: 700;">Ability Check:&nbsp;</span>
						<span name="attr_abilitycheck_display"></span>
					</div>

					<!-- CR -->
					<input type="checkbox" name="attr_abilitycr_show" class="sheet-abilitycrshow" hidden>
					<div class="sheet-abilitycr">
						<span style="font-weight: 700;">CR:&nbsp;</span>
						<span name="attr_abilitycr_display"></span>
					</div>

					<!-- Base Effect Description -->
					<input type="checkbox" name="attr_abilitybaseeffect_show" class="sheet-abilitybaseeffectshow" hidden>
					<div class="sheet-abilitybaseeffect">
						<span style="font-weight: 700;">Base Effect:&nbsp;</span>
						<span name="attr_abilitybaseeffect_display"></span>
					</div>

					<!-- Direct Hit Effect Description -->
					<input type="checkbox" name="attr_abilitydirecthit_show" class="sheet-abilitydirecthitshow" hidden>
					<div class="sheet-abilitydirecthit">
						<span style="font-weight: 700;">Direct Hit Effect:&nbsp;</span>
						<span name="attr_abilitydirecthit_display"></span>
					</div>

					<!-- Direct Hit Button -->
					<button class="hide" type="roll" name="roll_directDamageRoll" value="&{template:ffxivdamage} {{name=@{abilityname} }} {{Attack = [[@{abilitydirecthitdamage}]] }}">Hide</button>
				</div>


				<!-- Collapsed Ability View -->
				<div class="sheet-block-c" style="padding: 3px; position: absolute;">
					<div style="display: flex;">
						<button type="roll" class="sheet-diceroll-collapsed" value="@{abilityRollValue}" name="roll_abilityCheck"> <span name="attr_abilityname"></span> </button><br>

						<!-- Limitation -->
						<input type="checkbox" name="attr_limitation_show" class="sheet-limitationshow" hidden>
						<div class="sheet-limitation-collapsed">
							<input dir="rtl" type="number" name="attr_limitationamount" class="input-shorter-collapsed" style="position: absolute; top: 2px; left: 35px; width: 45px; height: 25px;">
							<span name="attr_limitation_display" class="input-shorter-collapsed" style="position: absolute; top: 0px; left: 80px;"></span>
						</div>
					</div>
					<span name="attr_abilitytags_display" class="sheet-tags-collapsed"></span>
				</div>
			</fieldset>
		</div>



		<div class=abilities-secondary>
			<label>SECONDARY ABILITIES</label>
			<fieldset class=repeating_secondaryability>
				<input type="checkbox" class="sheet-block-switch" name="attr_blockswitch" value="1" hidden>
				<input type="checkbox" class="sheet-block-collapse" name="attr_blockcollapse" value="1" hidden>
				<input type="text" name="attr_abilityRollValue" value="" hidden>
				

				<button type="action" class="toggle_repeating_npcaction_edit" name="act_edit"><span style="font-family:Pictos;">y</button><br>
				<button type="action" class="toggle_collapse" name="act_collapse"><span style="font-family:Pictos;">w</button><br>

				<!-- EDITING MODE - PRIMARY ABILITIES -->
				<div class="sheet-block-a" style="padding: 3px;">
					<span>Ability Name</span>
					<input type="text" name="attr_abilityname" placeholder="Storm's Path" required>
					<br>

					<span>Ability Tags</span>
					<input type="text" name="attr_abilitytags" placeholder="Primary, Physical">
					<br>

					<span>Limitation</span>
					<select name="attr_limitation">
						<option value="" selected>No Limitation</option>
						<option value="1">Once per phase</option>
						<option value="2">Two times per phase</option>
						<option value="3">Three times per phase</option>
					</select>
					<br>

					<span>Requirement</span>
					<input type="text" name="attr_abilityrequirement">
					<br>
					<span>Trigger</span>
					<input type="text" name="attr_abilitytrigger" placeholder="When an enemy within 10 squares begins their turn.">
					<br>

					<span>Cost</span>
					<input type="text" name="attr_abilitycost" placeholder="1 MP">
					<br>

					<span>Target</span>
					<input type="text" name="attr_abilitytarget" placeholder="Single">
					<br>

					<span>Range</span>
					<input type="text" name="attr_abilityrange" placeholder="5 Squares">
					<br>

					<span>Check</span>
					<select class="sheet-checkcheckbox" name="attr_abilitycheck">
						<option value="" selected="selected">No Check</option>
						<option value="1d20">Special</option>
						<option value="1d20 + @{char_strength}">STR</option>
						<option value="1d20 + @{char_dexterity}">DEX</option>
						<option value="1d20 + @{char_vitality}">VIT</option>
						<option value="1d20 + @{char_intelligence}">INT</option>
						<option value="1d20 + @{char_mind}">MND</option>
					</select>
					<br>
					<span>CR</span>
					<input type="text" name="attr_abilitycr" placeholder="Target's Defense">
					<br>
					<span>Base Effect</span>
					<input type="text" name="attr_abilitybaseeffect" placeholder="Deals 3 damage to the target" required>
					<br>

					<span>Base Effect</span>
					<div style="display: flex;">
						<input type="text" name="attr_abilitybaseeffectdamage" placeholder="1d6" style="width: 70px;">
						<span>&nbsp;</span>
						<select name="attr_abilitybaseeffectdamageorhealing">
							<option value="Damage">Damage</option>
							<option value="Healing">Healing</option>
						</select>
					</div>
					<br>

					<span>Base Effect Extra Effect</span>
					<input type="text" name="attr_abilitybaseeffectextraeffect" placeholder="Combo: Storm's Path">
					<br>

					<span>Direct Hit</span>
					<input type="text" name="attr_abilitydirecthit" placeholder="Deals an additional 2d6 damage">
					<br>

					<span>Direct Hit Damage</span>
					<div style="display: flex;">
						<input type="text" name="attr_abilitydirecthitdamage" placeholder="2d6" style="width: 70px;" required>
						<span>&nbsp;</span>
						<select name="attr_abilitydirecteffectdamageorhealing">
							<option value="Damage">Damage</option>
							<option value="Healing">Healing</option>
						</select>
					</div>
					<br>

					<span>Direct Hit Extra Effect</span>
					<input type="text" name="attr_abilitydirecthitextraeffect" placeholder="Generates Emnity">
				</div>

				<!-- DISPLAY MODE - PRIMARY ABILITIES -->
				<div class="sheet-block-b" style="padding: 3px;">
					<div style="display: flex;">
						<button type="roll" class="sheet-diceroll" value="@{abilityRollValue}" name="roll_abilityCheck" style="width: 70%; text-align: left;"> <span name="attr_abilityname"></span> </button><br>

						<!-- Limitation -->
						<input type="checkbox" name="attr_limitation_show" class="sheet-limitationshow" hidden>
						<div class="sheet-limitation" style="text-align: right; width: 30%;">
							<input dir="rtl" type="number" name="attr_limitationamount" value="0" class="input-shorter" style="position: relative; left: 17px; top: -2px; width: 80%; vertical-align: top;">
							<span name="attr_limitation_display" class="input-shorter" style="margin: auto;"></span>
						</div>
					</div>
					<!-- Tags -->
					<span name="attr_abilitytags_display" style="font-style: italic;"></span><br>

					<!-- Trigger -->
					<input type="checkbox" name="attr_trigger_show" class="sheet-triggershow" hidden>
					<div class="sheet-trigger">
						<span style="font-weight: 700;">Trigger:&nbsp;</span>
						<span name="attr_abilitytrigger_display"></span>
					</div>

					<!-- Requirement -->
					<input type="checkbox" name="attr_abilityrequirement_show" class="sheet-requirementshow" hidden>
					<div class="sheet-requirement">
						<span style="font-weight: 700;">Requirement:&nbsp;</span>
						<span name="attr_abilityrequirement_display"></span>
					</div>

					<!-- Target -->
					<input type="checkbox" name="attr_abilitytarget_show" class="sheet-targetshow" hidden>
					<div class="sheet-target">
						<span style="font-weight: 700;">Target:&nbsp;</span>
						<span name="attr_target_display"></span>
					</div>

					<!-- Cost -->
					<input type="checkbox" name="attr_abilitycost_show" class="sheet-costshow" hidden>
					<div class="sheet-cost">
						<span style="font-weight: 700;">Cost:&nbsp;</span>
						<span name="attr_abilitycost_display"></span>
					</div>

					<!-- Range -->
					<input type="checkbox" name="attr_range_show" class="sheet-rangeshow" hidden>
					<div class="sheet-range">
						<span style="font-weight: 700;">Range:&nbsp;</span>
						<span name="attr_range_display"></span>
					</div>

					<!-- Check -->
					<input type="checkbox" name="attr_abilitycheck_show" class="sheet-abilitycheckshow" hidden>
					<div class="sheet-abilitycheck">
						<span style="font-weight: 700;">Ability Check:&nbsp;</span>
						<span name="attr_abilitycheck_display"></span>
					</div>

					<!-- CR -->
					<input type="checkbox" name="attr_abilitycr_show" class="sheet-abilitycrshow" hidden>
					<div class="sheet-abilitycr">
						<span style="font-weight: 700;">CR:&nbsp;</span>
						<span name="attr_abilitycr_display"></span>
					</div>

					<!-- Base Effect Description -->
					<input type="checkbox" name="attr_abilitybaseeffect_show" class="sheet-abilitybaseeffectshow" hidden>
					<div class="sheet-abilitybaseeffect">
						<span style="font-weight: 700;">Base Effect:&nbsp;</span>
						<span name="attr_abilitybaseeffect_display"></span>
					</div>

					<!-- Direct Hit Effect Description -->
					<input type="checkbox" name="attr_abilitydirecthit_show" class="sheet-abilitydirecthitshow" hidden>
					<div class="sheet-abilitydirecthit">
						<span style="font-weight: 700;">Direct Hit Effect:&nbsp;</span>
						<span name="attr_abilitydirecthit_display"></span>
					</div>

					<!-- Direct Hit Button -->
					<button class="hide" type="roll" name="roll_directDamageRoll" value="&{template:ffxivdamage} {{name=@{abilityname} }} {{Attack = [[@{abilitydirecthitdamage}]] }}">Hide</button>
				</div>

				<!-- Collapsed Ability View -->
				<div class="sheet-block-c" style="padding: 3px; position: absolute;">
					<div style="display: flex;">
						<button type="roll" class="sheet-diceroll-collapsed" value="@{abilityRollValue}" name="roll_abilityCheck"> <span name="attr_abilityname"></span> </button><br>

						<!-- Limitation -->
						<input type="checkbox" name="attr_limitation_show" class="sheet-limitationshow" hidden>
						<div class="sheet-limitation-collapsed">
							<input dir="rtl" type="number" name="attr_limitationamount" class="input-shorter-collapsed" style="position: absolute; top: 2px; left: 35px; width: 45px; height: 25px;">
							<span name="attr_limitation_display" class="input-shorter-collapsed" style="position: absolute; top: 0px; left: 80px;"></span>
						</div>
					</div>
					<span name="attr_abilitytags_display" class="sheet-tags-collapsed"></span>
				</div>
			</fieldset>
		</div>



		<div class="abilities-instant">
			<label>INSTANT ABILITIES</label>
			<fieldset class="repeating_instantability">
				<input type="checkbox" class="sheet-block-switch" name="attr_blockswitch" value="1" hidden>
				<input type="checkbox" class="sheet-block-collapse" name="attr_blockcollapse" value="1" hidden>
				<input type="text" name="attr_abilityRollValue" value="" hidden>
				

				<button type="action" class="toggle_repeating_npcaction_edit" name="act_edit"><span style="font-family:Pictos;">y</button><br>
				<button type="action" class="toggle_collapse" name="act_collapse"><span style="font-family:Pictos;">w</button><br>

				<!-- EDITING MODE - PRIMARY ABILITIES -->
				<div class="sheet-block-a" style="padding: 3px;">
					<span>Ability Name</span>
					<input type="text" name="attr_abilityname" placeholder="Storm's Path" required>
					<br>

					<span>Ability Tags</span>
					<input type="text" name="attr_abilitytags" placeholder="Primary, Physical">
					<br>

					<span>Limitation</span>
					<select name="attr_limitation">
						<option value="" selected>No Limitation</option>
						<option value="1">Once per phase</option>
						<option value="2">Two times per phase</option>
						<option value="3">Three times per phase</option>
					</select>
					<br>

					<span>Requirement</span>
					<input type="text" name="attr_abilityrequirement">
					<br>
					<span>Trigger</span>
					<input type="text" name="attr_abilitytrigger" placeholder="When an enemy within 10 squares begins their turn.">
					<br>

					<span>Cost</span>
					<input type="text" name="attr_abilitycost" placeholder="1 MP">
					<br>

					<span>Target</span>
					<input type="text" name="attr_abilitytarget" placeholder="Single">
					<br>

					<span>Range</span>
					<input type="text" name="attr_abilityrange" placeholder="5 Squares">
					<br>

					<span>Check</span>
					<select class="sheet-checkcheckbox" name="attr_abilitycheck">
						<option value="" selected="selected">No Check</option>
						<option value="1d20">Special</option>
						<option value="1d20 + @{char_strength}">STR</option>
						<option value="1d20 + @{char_dexterity}">DEX</option>
						<option value="1d20 + @{char_vitality}">VIT</option>
						<option value="1d20 + @{char_intelligence}">INT</option>
						<option value="1d20 + @{char_mind}">MND</option>
					</select>
					<br>
					<span>CR</span>
					<input type="text" name="attr_abilitycr" placeholder="Target's Defense">
					<br>
					<span>Base Effect</span>
					<input type="text" name="attr_abilitybaseeffect" placeholder="Deals 3 damage to the target" required>
					<br>

					<span>Base Effect</span>
					<div style="display: flex;">
						<input type="text" name="attr_abilitybaseeffectdamage" placeholder="1d6" style="width: 70px;" required>
						<span>&nbsp;</span>
						<select name="attr_abilitybaseeffectdamageorhealing">
							<option value="Damage">Damage</option>
							<option value="Healing">Healing</option>
						</select>
					</div>
					<br>

					<span>Base Effect Extra Effect</span>
					<input type="text" name="attr_abilitybaseeffectextraeffect" placeholder="Combo: Storm's Path">
					<br>

					<span>Direct Hit</span>
					<input type="text" name="attr_abilitydirecthit" placeholder="Deals an additional 2d6 damage">
					<br>

					<span>Direct Hit Damage</span>
					<div style="display: flex;">
						<input type="text" name="attr_abilitydirecthitdamage" placeholder="2d6" style="width: 70px;" required>
						<span>&nbsp;</span>
						<select name="attr_abilitydirecteffectdamageorhealing">
							<option value="Damage">Damage</option>
							<option value="Healing">Healing</option>
						</select>
					</div>
					<br>

					<span>Direct Hit Extra Effect</span>
					<input type="text" name="attr_abilitydirecthitextraeffect" placeholder="Generates Emnity">
				</div>

				<!-- DISPLAY MODE - PRIMARY ABILITIES -->
				<div class="sheet-block-b" style="padding: 3px;">
					<div style="display: flex;">
						<button type="roll" class="sheet-diceroll" value="@{abilityRollValue}" name="roll_abilityCheck" style="width: 70%; text-align: left;"> <span name="attr_abilityname"></span> </button><br>

						<!-- Limitation -->
						<input type="checkbox" name="attr_limitation_show" class="sheet-limitationshow" hidden>
						<div class="sheet-limitation" style="text-align: right; width: 30%;">
							<input dir="rtl" type="number" name="attr_limitationamount" value="0" class="input-shorter" style="position: relative; left: 17px; top: -2px; width: 80%; vertical-align: top;">
							<span name="attr_limitation_display" class="input-shorter" style="margin: auto;"></span>
						</div>
					</div>
					<!-- Tags -->
					<span name="attr_abilitytags_display" style="font-style: italic;"></span><br>

					<!-- Trigger -->
					<input type="checkbox" name="attr_trigger_show" class="sheet-triggershow" hidden>
					<div class="sheet-trigger">
						<span style="font-weight: 700;">Trigger:&nbsp;</span>
						<span name="attr_abilitytrigger_display"></span>
					</div>

					<!-- Requirement -->
					<input type="checkbox" name="attr_abilityrequirement_show" class="sheet-requirementshow" hidden>
					<div class="sheet-requirement">
						<span style="font-weight: 700;">Requirement:&nbsp;</span>
						<span name="attr_abilityrequirement_display"></span>
					</div>

					<!-- Target -->
					<input type="checkbox" name="attr_abilitytarget_show" class="sheet-targetshow" hidden>
					<div class="sheet-target">
						<span style="font-weight: 700;">Target:&nbsp;</span>
						<span name="attr_target_display"></span>
					</div>

					<!-- Cost -->
					<input type="checkbox" name="attr_abilitycost_show" class="sheet-costshow" hidden>
					<div class="sheet-cost">
						<span style="font-weight: 700;">Cost:&nbsp;</span>
						<span name="attr_abilitycost_display"></span>
					</div>

					<!-- Range -->
					<input type="checkbox" name="attr_range_show" class="sheet-rangeshow" hidden>
					<div class="sheet-range">
						<span style="font-weight: 700;">Range:&nbsp;</span>
						<span name="attr_range_display"></span>
					</div>

					<!-- Check -->
					<input type="checkbox" name="attr_abilitycheck_show" class="sheet-abilitycheckshow" hidden>
					<div class="sheet-abilitycheck">
						<span style="font-weight: 700;">Ability Check:&nbsp;</span>
						<span name="attr_abilitycheck_display"></span>
					</div>

					<!-- CR -->
					<input type="checkbox" name="attr_abilitycr_show" class="sheet-abilitycrshow" hidden>
					<div class="sheet-abilitycr">
						<span style="font-weight: 700;">CR:&nbsp;</span>
						<span name="attr_abilitycr_display"></span>
					</div>

					<!-- Base Effect Description -->
					<input type="checkbox" name="attr_abilitybaseeffect_show" class="sheet-abilitybaseeffectshow" hidden>
					<div class="sheet-abilitybaseeffect">
						<span style="font-weight: 700;">Base Effect:&nbsp;</span>
						<span name="attr_abilitybaseeffect_display"></span>
					</div>

					<!-- Direct Hit Effect Description -->
					<input type="checkbox" name="attr_abilitydirecthit_show" class="sheet-abilitydirecthitshow" hidden>
					<div class="sheet-abilitydirecthit">
						<span style="font-weight: 700;">Direct Hit Effect:&nbsp;</span>
						<span name="attr_abilitydirecthit_display"></span>
					</div>

					<!-- Direct Hit Button -->
					<button class="hide" type="roll" name="roll_directDamageRoll" value="&{template:ffxivdamage} {{name=@{abilityname} }} {{Attack = [[@{abilitydirecthitdamage}]] }}">Hide</button>
				</div>

				<!-- Collapsed Ability View -->
				<div class="sheet-block-c" style="padding: 3px; position: absolute;">
					<div style="display: flex;">
						<button type="roll" class="sheet-diceroll-collapsed" value="@{abilityRollValue}" name="roll_abilityCheck"> <span name="attr_abilityname"></span> </button><br>

						<!-- Limitation -->
						<input type="checkbox" name="attr_limitation_show" class="sheet-limitationshow" hidden>
						<div class="sheet-limitation-collapsed">
							<input dir="rtl" type="number" name="attr_limitationamount" class="input-shorter-collapsed" style="position: absolute; top: 2px; left: 35px; width: 45px; height: 25px;">
							<span name="attr_limitation_display" class="input-shorter-collapsed" style="position: absolute; top: 0px; left: 80px;"></span>
						</div>
					</div>
					<span name="attr_abilitytags_display" class="sheet-tags-collapsed"></span>
				</div>
			</fieldset>		
		</div>
	</div>
</div>

<!-- PRIMARY ROLL TEMPLATE -->
<rolltemplate class="sheet-rolltemplate-ffxivmain">
	<div class="sheet-template-container">

		<!-- Primary Roll Template Header -->
		<div class="sheet-template-masterheader-{{header}}">
			<div class=sheet-template-header>
				{{#name}}
				<div class="sheet-header">{{name}}</div>
				{{/name}}
			</div>
			<div class="sheet-template-row">
				{{#tags}}
				<div class="sheet-tags">{{tags}}</div>
				{{/tags}}
			</div>
		</div>
		<hr class="sheet-line">


		<!-- Primary Roll Template Base Effect -->
		{{#baseeffect}}
		<div class="sheet-info-larger">{{baseeffect}}</div>
		{{/baseeffect}}


		<!-- Primary Roll Template Check -->
		{{#check}}
		<div class="sheet-template-header">
			{{#allprops() rolltype name tags basedamage directdamage effect baseeffect check damagetype header}}
    		<div class="sheet-value">{{value}}</div>
 			{{/allprops() rolltype name tags basedamage directdamage effect baseeffect check damagetype header}}
 			<div class="sheet-info">
 				<span>{{check}}</span>
 			</div>
		</div>
		{{/check}}

		{{#basedamage}}
		<hr class="sheet-line">
		<div class="sheet-template-header">
			<div class="sheet-value">
				<span class="inlinerollresult" style="color:white;font-family: 'Bebas Neue, sans-serif';padding-bottom:'2px">{{basedamage}}</span>
			</div>
			{{#damagetype}}
			<div class="sheet-info">
				<span>{{damagetype}}</span>
			</div>
			{{/damagetype}}
		</div>
		{{/basedamage}}
		{{#effect}}
		<div class="sheet-template-row">
			<div class="sheet-tags">{{effect}}</div>
		</div>
		{{/effect}}

		{{#directdamage}}
		<hr class="sheet-line">
			{{directdamage}}
		{{/directdamage}}

	</div>
</rolltemplate>

<!-- DAMAGE ROLL TEMPLATE -->
<rolltemplate class="sheet-rolltemplate-ffxivdamage">
	<div class="sheet-template-container">
		<div class="sheet-template-header">
			{{#name}}
			<div class="sheet-header">{{name}}</div>
			{{/name}}
		</div>
		<div class="sheet-template-row">
			<div class="sheet-tags">DIRECT HIT</div>
		</div>
		<hr class="sheet-line">
		<div class="sheet-template-header">
			{{#allprops() name}}
			<div class="sheet-value">{{value}}</div>
			{{/allprops() name}}
		</div>
		<div class="sheet-template-row">
			<div class="sheet-tags-2">DAMAGE</div>
		</div>
	</div>
</rolltemplate>




<!-- INFO ROLL TEMPLATE -->
<rolltemplate class="sheet-rolltemplate-info">
	<div class="sheet-template-container">
		<div class="sheet-header">
			{{#name}}
			<span>{{name}}</span>
			{{/name}}
		</div>
		<div class="sheet-tag">
			{{#trait}}
			<span>{{trait}}</span>
			{{/trait}}
		</div>
		<div class="sheet-desc">
			{{#desc}}
			<span>{{desc}}</span>
			{{/desc}}
		</div>

	</div>
</rolltemplate>

<!-- ATTRIBUTE ROLL TEMPLATE -->
<rolltemplate class="sheet-rolltemplate-attribute">
	<div class="sheet-template-container">
		<div class="sheet-header">
			{{#name}}
			<span>{{name}}</span>
			{{/name}}
		</div>


		<div class="sheet-template-header">
			{{#allprops() name check}}
			<div class="sheet-value">{{value}}</div>
			{{/allprops() name check}}
		</div>
		{{#check}}
		<div class="sheet-info">
			<span>{{check}}</span>
		</div>
		{{/check}}
	</div>
</rolltemplate>


<script type="text/worker">
	// Edit Button Functionality (For Primary)
	on("clicked:repeating_primaryability:edit", function() {
		getAttrs(["repeating_primaryability_abilityname", "repeating_primaryability_blockswitch"], function(values) {
			let name = values.repeating_primaryability_abilityname;
			let switchToggle = values.repeating_primaryability_blockswitch;
			switchToggle = 1 - switchToggle;


			setAttrs({
				repeating_primaryability_blockswitch: switchToggle,
				repeating_primaryability_blockcollapse: 0,
			});
		});
	});

	// Collapse for Primary
	on("clicked:repeating_primaryability:collapse", function() {
		getAttrs(["repeating_primaryability_blockcollapse"], function(values) {
			let switchToggle = values.repeating_primaryability_blockcollapse;
			switchToggle = 1 - switchToggle;

			setAttrs({
				repeating_primaryability_blockcollapse: switchToggle,
			});
		});
	});

	// Collapse for Secondary
	on("clicked:repeating_secondaryability:collapse", function() {
		getAttrs(["repeating_secondaryability_blockcollapse"], function(values) {
			let switchToggle = values.repeating_secondaryability_blockcollapse;
			switchToggle = 1 - switchToggle;

			setAttrs({
				repeating_secondaryability_blockcollapse: switchToggle,
			});
		});
	});

	// Collapse for Instant
	on("clicked:repeating_instantability:collapse", function() {
		getAttrs(["repeating_instantability_blockcollapse"], function(values) {
			let switchToggle = values.repeating_instantability_blockcollapse;
			switchToggle = 1 - switchToggle;

			setAttrs({
				repeating_instantability_blockcollapse: switchToggle,
			});
		});
	});

	// Collapse for Limitbreak
	on("clicked:collapse", function() {
		getAttrs(["limitbreakcollapse"], function(values) {
			let switchToggle = values.limitbreakcollapse;
			switchToggle = 1 - switchToggle;
			setAttrs({
				limitbreakcollapse: switchToggle,
			});
		});
	});

	on("clicked:repeating_primaryability:edit", function() {
		getAttrs([
			"repeating_primaryability_abilityname", // Name
			"repeating_primaryability_abilitytags",
			"repeating_primaryability_abilitybaseeffect",
			"repeating_primaryability_limitation",
			"repeating_primaryability_limitationamount",
			"repeating_primaryability_abilityrequirement",
			"repeating_primaryability_abilitytrigger",
			"repeating_primaryability_abilitycost",
			"repeating_primaryability_abilitytarget",
			"repeating_primaryability_abilityrange",
			"repeating_primaryability_abilitycheck",
			"repeating_primaryability_abilitycr",
			"repeating_primaryability_abilitybaseeffectdamage",
			"repeating_primaryability_abilitybaseeffectdamageorhealing",
			"repeating_primaryability_abilitybaseeffectextraeffect",
			"repeating_primaryability_abilitydirecthit",
			"repeating_primaryability_abilitydirecthitdamage",
			"repeating_primaryability_abilitydirecteffectdamageorhealing",
			"repeating_primaryability_abilitydirecthitextraeffect",
			"repeating_primaryability_limitation_show",
			], function(values){
				// ROLL TEMPLATE STRING BUILDER	
				var rollvalue = "&{template:ffxivmain} {{header=primary}} {{name=@{abilityname} }} {{tags=@{abilitytags} }} {{baseeffect=@{abilitybaseeffect} }}"

				if (values.repeating_primaryability_abilitycheck) {
					rollvalue = rollvalue.concat(" {{Attack = [[@{abilitycheck}]]}} ")
					rollvalue = rollvalue.concat(" {{check=Ability Check }} ")
				}

				if (values.repeating_primaryability_abilitybaseeffectdamage) {
					rollvalue = rollvalue.concat(" {{basedamage=[[@{abilitybaseeffectdamage}]] }} ")
				}

				if (values.repeating_primaryability_abilitybaseeffectdamageorhealing) {
					rollvalue = rollvalue.concat(" {{damagetype=@{abilitybaseeffectdamageorhealing} }} ")
				}

				if (values.repeating_primaryability_abilitybaseeffectextraeffect) {
					rollvalue = rollvalue.concat(" {{effect=@{abilitybaseeffectextraeffect} }} ")
				}

				if (values.repeating_primaryability_abilitydirecthit) {
					rollvalue = rollvalue.concat(" {{directdamage=[ROLL DIRECT HIT](~repeating_primaryability_directDamageRoll) }} ")
				}

				// CONDITIONAL DISPLAYS
				var abilityTagsDisplay;
				if (values.repeating_primaryability_abilitytags) {
					abilityTagsDisplay = values.repeating_primaryability_abilitytags;
				}

				// Limitation Display
				var limitationDisplay;
				var switchToggleLimitation;
				if (values.repeating_primaryability_limitation) {
					limitationDisplay = "/" + values.repeating_primaryability_limitation;

					switchToggleLimitation = "on";
				} else {
					switchToggleLimitation = 0;
				}

				// Target Display
				var targetDisplay;
				var switchToggleTarget;
				if (values.repeating_primaryability_abilitytarget) {
					targetDisplay = values.repeating_primaryability_abilitytarget;
					switchToggleTarget = "on";
				} else {
					switchToggleTarget = 0;
				}

				// Cost Display
				var costDisplay;
				var switchToggleCost;
				if (values.repeating_primaryability_abilitycost) {
					costDisplay = values.repeating_primaryability_abilitycost;
					switchToggleCost = "on";
				} else {
					switchToggleCost = 0;
				}

				// Range Display
				var rangeDisplay;
				var switchToggleRange;
				if (values.repeating_primaryability_abilityrange) {
					rangeDisplay = values.repeating_primaryability_abilityrange;
					switchToggleRange = "on";
				} else {
					switchToggleRange = 0;
				}

				// Check Display
				var checkDisplay;
				var switchToggleCheck;
				if (values.repeating_primaryability_abilitycheck) {
					switch (values.repeating_primaryability_abilitycheck) {
						case '1d20 + @{char_strength}':
							checkDisplay = "STR"
							break;
						case '1d20 + @{char_dexterity}':
							checkDisplay = "DEX"
							break;
						case '1d20 + @{char_vitality}':
							checkDisplay = "VIT"
							break;
						case '1d20 + @{char_intelligence}':
							checkDisplay = "INT"
							break;
						case '1d20 + @{char_mind}':
							checkDisplay = "MND"
							break;
						default:
							checkDisplay = "Special"
					}
					switchToggleCheck = "on";
				} else {
					switchToggleCheck = 0;
				}

				// CR Display
				var crDisplay;
				var switchToggleCR;
				if (values.repeating_primaryability_abilitycr) {
					crDisplay = values.repeating_primaryability_abilitycr;
					switchToggleCR = "on"
				} else {
					switchToggleCR = 0;
				}

				// Base Effect Display
				var baseeffectDisplay;
				var switchToggleBaseEffect;
				if (values.repeating_primaryability_abilitybaseeffect) {
					baseeffectDisplay = values.repeating_primaryability_abilitybaseeffect;
					switchToggleBaseEffect = "on";
				} else {
					switchToggleBaseEffect = 0;
				}

				// Direct Hit Display
				var directhitDisplay;
				var switchToggleDirectHit;
				if (values.repeating_primaryability_abilitydirecthit) {
					directhitDisplay = values.repeating_primaryability_abilitydirecthit;
					switchToggleDirectHit = "on";
				} else {
					switchToggleDirectHit = 0;
				}

				// Trigger Display
				var triggerDisplay;
				var switchToggleTrigger;
				if (values.repeating_primaryability_abilitytrigger) {
					triggerDisplay = values.repeating_primaryability_abilitytrigger;
					switchToggleTrigger = "on";
				} else {
					switchToggleTrigger = 0;
				}

				// Requirement Display
				var requirementDisplay;
				var switchToggleRequirement;
				if (values.repeating_primaryability_abilityrequirement) {
					requirementDisplay = values.repeating_primaryability_abilityrequirement;
					switchToggleRequirement = "on";
				} else {
					switchToggleRequirement = 0;
				}

				setAttrs({
					repeating_primaryability_abilityRollValue: rollvalue,
					repeating_primaryability_abilitytags_display: abilityTagsDisplay,
					repeating_primaryability_limitation_show: switchToggleLimitation,
					repeating_primaryability_limitation_display: limitationDisplay,
					repeating_primaryability_abilitytarget_show: switchToggleTarget,
					repeating_primaryability_abilitytarget_display: targetDisplay,
					repeating_primaryability_abilitycost_show: switchToggleCost,
					repeating_primaryability_abilitycost_display: costDisplay,
					repeating_primaryability_range_show: switchToggleRange,
					repeating_primaryability_range_display: rangeDisplay,
					repeating_primaryability_abilitycheck_show: switchToggleCheck,
					repeating_primaryability_abilitycheck_display: checkDisplay,
					repeating_primaryability_abilitycr_show: switchToggleCR,
					repeating_primaryability_abilitycr_display: crDisplay,
					repeating_primaryability_abilitybaseeffect_show: switchToggleBaseEffect,
					repeating_primaryability_abilitybaseeffect_display: baseeffectDisplay,
					repeating_primaryability_abilitydirecthit_show: switchToggleDirectHit,
					repeating_primaryability_abilitydirecthit_display: directhitDisplay,
					repeating_primaryability_trigger_show: switchToggleTrigger,
					repeating_primaryability_abilitytrigger_display: triggerDisplay,
					repeating_primaryability_abilityrequirement_show:switchToggleRequirement,
					repeating_primaryability_abilityrequirement_display:requirementDisplay,
				});
		});
	});

	// Edit Button Functionality (For Secondary)
	on("clicked:repeating_secondaryability:edit", function() {
		getAttrs(["repeating_secondaryability_abilityname", "repeating_secondaryability_blockswitch"], function(values) {
			let name = values.repeating_secondaryability_abilityname;
			let switchToggle = values.repeating_secondaryability_blockswitch;
			switchToggle = 1 - switchToggle;
			setAttrs({
				repeating_secondaryability_blockswitch: switchToggle,
				repeating_secondaryability_blockcollapse: 0,
			});
		});
	});


	on("clicked:repeating_secondaryability:edit", function() {
		getAttrs([
			"repeating_secondaryability_abilityname", // Name
			"repeating_secondaryability_abilitytags",
			"repeating_secondaryability_abilitybaseeffect",
			"repeating_secondaryability_limitation",
			"repeating_secondaryability_limitationamount",
			"repeating_secondaryability_abilityrequirement",
			"repeating_secondaryability_abilitytrigger",
			"repeating_secondaryability_abilitycost",
			"repeating_secondaryability_abilitytarget",
			"repeating_secondaryability_abilityrange",
			"repeating_secondaryability_abilitycheck",
			"repeating_secondaryability_abilitycr",
			"repeating_secondaryability_abilitybaseeffectdamage",
			"repeating_secondaryability_abilitybaseeffectdamageorhealing",
			"repeating_secondaryability_abilitybaseeffectextraeffect",
			"repeating_secondaryability_abilitydirecthit",
			"repeating_secondaryability_abilitydirecthitdamage",
			"repeating_secondaryability_abilitydirecteffectdamageorhealing",
			"repeating_secondaryability_abilitydirecthitextraeffect",
			"repeating_secondaryability_limitation_show",
			], function(values){

				// ROLL TEMPLATE STRING BUILDER	
				var rollvalue = "&{template:ffxivmain} {{header=secondary}} {{name=@{abilityname} }} {{tags=@{abilitytags} }} {{baseeffect=@{abilitybaseeffect} }}"

				if (values.repeating_secondaryability_abilitycheck) {
					rollvalue = rollvalue.concat(" {{Attack = [[@{abilitycheck}]]}} ")
					rollvalue = rollvalue.concat(" {{check=Ability Check }} ")
				}

				if (values.repeating_secondaryability_abilitybaseeffectdamage) {
					rollvalue = rollvalue.concat(" {{basedamage=[[@{abilitybaseeffectdamage}]] }} ")
				}

				if (values.repeating_secondaryability_abilitybaseeffectdamageorhealing) {
					rollvalue = rollvalue.concat(" {{damagetype=@{abilitybaseeffectdamageorhealing} }} ")
				}

				if (values.repeating_secondaryability_abilitybaseeffectextraeffect) {
					rollvalue = rollvalue.concat(" {{effect=@{abilitybaseeffectextraeffect} }} ")
				}

				if (values.repeating_secondaryability_abilitydirecthit) {
					rollvalue = rollvalue.concat(" {{directdamage=[ROLL DIRECT HIT](~repeating_secondaryability_directDamageRoll) }} ")
				}

				// CONDITIONAL DISPLAYS
				var abilityTagsDisplay;
				if (values.repeating_secondaryability_abilitytags) {
					abilityTagsDisplay = values.repeating_secondaryability_abilitytags;
				}

				// Limitation Display
				var limitationDisplay;
				var switchToggleLimitation;
				if (values.repeating_secondaryability_limitation) {
					limitationDisplay = "/" + values.repeating_secondaryability_limitation;

					switchToggleLimitation = "on";
				} else {
					switchToggleLimitation = 0;
				}

				// Target Display
				var targetDisplay;
				var switchToggleTarget;
				if (values.repeating_secondaryability_abilitytarget) {
					targetDisplay = values.repeating_secondaryability_abilitytarget;
					switchToggleTarget = "on";
				} else {
					switchToggleTarget = 0;
				}

				// Range Display
				var rangeDisplay;
				var switchToggleRange;
				if (values.repeating_secondaryability_abilityrange) {
					rangeDisplay = values.repeating_secondaryability_abilityrange;
					switchToggleRange = "on";
				} else {
					switchToggleRange = 0;
				}

				// Check Display
				var checkDisplay;
				var switchToggleCheck;
				if (values.repeating_secondaryability_abilitycheck) {
					switch (values.repeating_secondaryability_abilitycheck) {
						case '1d20 + @{char_strength}':
							checkDisplay = "STR"
							break;
						case '1d20 + @{char_dexterity}':
							checkDisplay = "DEX"
							break;
						case '1d20 + @{char_vitality}':
							checkDisplay = "VIT"
							break;
						case '1d20 + @{char_intelligence}':
							checkDisplay = "INT"
							break;
						case '1d20 + @{char_mind}':
							checkDisplay = "MND"
							break;
						default:
							checkDisplay = "Special"
					}
					switchToggleCheck = "on";
				} else {
					switchToggleCheck = 0;
				}

				// CR Display
				var crDisplay;
				var switchToggleCR;
				if (values.repeating_secondaryability_abilitycr) {
					crDisplay = values.repeating_secondaryability_abilitycr;
					switchToggleCR = "on"
				} else {
					switchToggleCR = 0;
				}

				// Base Effect Display
				var baseeffectDisplay;
				var switchToggleBaseEffect;
				if (values.repeating_secondaryability_abilitybaseeffect) {
					baseeffectDisplay = values.repeating_secondaryability_abilitybaseeffect;
					switchToggleBaseEffect = "on";
				} else {
					switchToggleBaseEffect = 0;
				}

				// Cost Display
				var costDisplay;
				var switchToggleCost;
				if (values.repeating_secondaryability_abilitycost) {
					costDisplay = values.repeating_secondaryability_abilitycost;
					switchToggleCost = "on";
				} else {
					switchToggleCost = 0;
				}

				// Direct Hit Display
				var directhitDisplay;
				var switchToggleDirectHit;
				if (values.repeating_secondaryability_abilitydirecthit) {
					directhitDisplay = values.repeating_secondaryability_abilitydirecthit;
					switchToggleDirectHit = "on";
				} else {
					switchToggleDirectHit = 0;
				}

				// Trigger Display
				var triggerDisplay;
				var switchToggleTrigger;
				if (values.repeating_secondaryability_abilitytrigger) {
					triggerDisplay = values.repeating_secondaryability_abilitytrigger;
					switchToggleTrigger = "on";
				} else {
					switchToggleTrigger = 0;
				}

				// Requirement Display
				var requirementDisplay;
				var switchToggleRequirement;
				if (values.repeating_secondaryability_abilityrequirement) {
					requirementDisplay = values.repeating_secondaryability_abilityrequirement;
					switchToggleRequirement = "on";
				} else {
					switchToggleRequirement = 0;
				}

				setAttrs({
					repeating_secondaryability_abilityRollValue: rollvalue,
					repeating_secondaryability_abilitytags_display: abilityTagsDisplay,
					repeating_secondaryability_limitation_show: switchToggleLimitation,
					repeating_secondaryability_limitation_display: limitationDisplay,
					repeating_secondaryability_abilitytarget_show: switchToggleTarget,
					repeating_secondaryability_abilitytarget_display: targetDisplay,
					repeating_secondaryability_abilitycost_show: switchToggleCost,
					repeating_secondaryability_abilitycost_display: costDisplay,
					repeating_secondaryability_range_show: switchToggleRange,
					repeating_secondaryability_range_display: rangeDisplay,
					repeating_secondaryability_abilitycheck_show: switchToggleCheck,
					repeating_secondaryability_abilitycheck_display: checkDisplay,
					repeating_secondaryability_abilitycr_show: switchToggleCR,
					repeating_secondaryability_abilitycr_display: crDisplay,
					repeating_secondaryability_abilitybaseeffect_show: switchToggleBaseEffect,
					repeating_secondaryability_abilitybaseeffect_display: baseeffectDisplay,
					repeating_secondaryability_abilitydirecthit_show: switchToggleDirectHit,
					repeating_secondaryability_abilitydirecthit_display: directhitDisplay,
					repeating_secondaryability_trigger_show: switchToggleTrigger,
					repeating_secondaryability_abilitytrigger_display: triggerDisplay,
					repeating_secondaryability_abilityrequirement_show:switchToggleRequirement,
					repeating_secondaryability_abilityrequirement_display:requirementDisplay,
				});
		});
	});

	// Edit Button Functionality (For Instant)
	on("clicked:repeating_instantability:edit", function() {
		getAttrs(["repeating_instantability_abilityname", "repeating_instantability_blockswitch", "repeating_instantability_tagphysical", "repeating_instantability_tagmagical", "repeating_instantability_tagice", "repeating_instantability_tagfire", "repeating_instantability_tagthunder", "repeating_instantability_tagwind", "repeating_instantability_tagearth", "repeating_instantability_tagwater", "repeating_instantability_taginvoked"], function(values) {
			let name = values.repeating_instantability_abilityname;
			let switchToggle = values.repeating_instantability_blockswitch;
			switchToggle = 1 - switchToggle;


			setAttrs({
				repeating_instantability_blockswitch: switchToggle,
				repeating_instantability_blockcollapse: 0,
			});
		});
	});

	on("clicked:repeating_instantability:edit", function() {
		getAttrs([
			"repeating_instantability_abilityname", // Name
			"repeating_instantability_abilitytags",
			"repeating_instantability_abilitybaseeffect",
			"repeating_instantability_limitation",
			"repeating_instantability_limitationamount",
			"repeating_instantability_abilityrequirement",
			"repeating_instantability_abilitytrigger",
			"repeating_instantability_abilitycost",
			"repeating_instantability_abilitytarget",
			"repeating_instantability_abilityrange",
			"repeating_instantability_abilitycheck",
			"repeating_instantability_abilitycr",
			"repeating_instantability_abilitybaseeffectdamage",
			"repeating_instantability_abilitybaseeffectdamageorhealing",
			"repeating_instantability_abilitybaseeffectextraeffect",
			"repeating_instantability_abilitydirecthit",
			"repeating_instantability_abilitydirecthitdamage",
			"repeating_instantability_abilitydirecteffectdamageorhealing",
			"repeating_instantability_abilitydirecthitextraeffect",
			"repeating_instantability_limitation_show",
			], function(values){

				// ROLL TEMPLATE STRING BUILDER	
				var rollvalue = "&{template:ffxivmain} {{header=instant}} {{name=@{abilityname} }} {{tags=@{abilitytags} }} {{baseeffect=@{abilitybaseeffect} }}"

				if (values.repeating_instantability_abilitycheck) {
					rollvalue = rollvalue.concat(" {{Attack = [[@{abilitycheck}]]}} ")
					rollvalue = rollvalue.concat(" {{check=Ability Check }} ")
				}

				if (values.repeating_instantability_abilitybaseeffectdamage) {
					rollvalue = rollvalue.concat(" {{basedamage=[[@{abilitybaseeffectdamage}]] }} ")
				}

				if (values.repeating_instantability_abilitybaseeffectdamageorhealing) {
					rollvalue = rollvalue.concat(" {{damagetype=@{abilitybaseeffectdamageorhealing} }} ")
				}

				if (values.repeating_instantability_abilitybaseeffectextraeffect) {
					rollvalue = rollvalue.concat(" {{effect=@{abilitybaseeffectextraeffect} }} ")
				}

				if (values.repeating_instantability_abilitydirecthit) {
					rollvalue = rollvalue.concat(" {{directdamage=[ROLL DIRECT HIT](~repeating_instantability_directDamageRoll) }} ")
				}

				// CONDITIONAL DISPLAYS
				var abilityTagsDisplay;
				if (values.repeating_instantability_abilitytags) {
					abilityTagsDisplay = values.repeating_instantability_abilitytags;
				}

				// Limitation Display
				var limitationDisplay;
				var switchToggleLimitation;
				if (values.repeating_instantability_limitation) {
					limitationDisplay = "/" + values.repeating_instantability_limitation;

					switchToggleLimitation = "on";
				} else {
					switchToggleLimitation = 0;
				}

				// Target Display
				var targetDisplay;
				var switchToggleTarget;
				if (values.repeating_instantability_abilitytarget) {
					targetDisplay = values.repeating_instantability_abilitytarget;
					switchToggleTarget = "on";
				} else {
					switchToggleTarget = 0;
				}

				// Cost Display
				var costDisplay;
				var switchToggleCost;
				if (values.repeating_instantability_abilitycost) {
					costDisplay = values.repeating_instantability_abilitycost;
					switchToggleCost = "on";
				} else {
					switchToggleCost = 0;
				}

				// Range Display
				var rangeDisplay;
				var switchToggleRange;
				if (values.repeating_instantability_abilityrange) {
					rangeDisplay = values.repeating_instantability_abilityrange;
					switchToggleRange = "on";
				} else {
					switchToggleRange = 0;
				}

				// Check Display
				var checkDisplay;
				var switchToggleCheck;
				if (values.repeating_instantability_abilitycheck) {
					switch (values.repeating_instantability_abilitycheck) {
						case '1d20 + @{char_strength}':
							checkDisplay = "STR"
							break;
						case '1d20 + @{char_dexterity}':
							checkDisplay = "DEX"
							break;
						case '1d20 + @{char_vitality}':
							checkDisplay = "VIT"
							break;
						case '1d20 + @{char_intelligence}':
							checkDisplay = "INT"
							break;
						case '1d20 + @{char_mind}':
							checkDisplay = "MND"
							break;
						default:
							checkDisplay = "Special"
					}
					switchToggleCheck = "on";
				} else {
					switchToggleCheck = 0;
				}

				// CR Display
				var crDisplay;
				var switchToggleCR;
				if (values.repeating_instantability_abilitycr) {
					crDisplay = values.repeating_instantability_abilitycr;
					switchToggleCR = "on"
				} else {
					switchToggleCR = 0;
				}

				// Base Effect Display
				var baseeffectDisplay;
				var switchToggleBaseEffect;
				if (values.repeating_instantability_abilitybaseeffect) {
					baseeffectDisplay = values.repeating_instantability_abilitybaseeffect;
					switchToggleBaseEffect = "on";
				} else {
					switchToggleBaseEffect = 0;
				}

				// Direct Hit Display
				var directhitDisplay;
				var switchToggleDirectHit;
				if (values.repeating_instantability_abilitydirecthit) {
					directhitDisplay = values.repeating_instantability_abilitydirecthit;
					switchToggleDirectHit = "on";
				} else {
					switchToggleDirectHit = 0;
				}

				// Trigger Display
				var triggerDisplay;
				var switchToggleTrigger;
				if (values.repeating_instantability_abilitytrigger) {
					triggerDisplay = values.repeating_instantability_abilitytrigger;
					switchToggleTrigger = "on";
				} else {
					switchToggleTrigger = 0;
				}

				// Requirement Display
				var requirementDisplay;
				var switchToggleRequirement;
				if (values.repeating_instantability_abilityrequirement) {
					requirementDisplay = values.repeating_instantability_abilityrequirement;
					switchToggleRequirement = "on";
				} else {
					switchToggleRequirement = 0;
				}

				setAttrs({
					repeating_instantability_abilityRollValue: rollvalue,
					repeating_instantability_abilitytags_display: abilityTagsDisplay,
					repeating_instantability_limitation_show: switchToggleLimitation,
					repeating_instantability_limitation_display: limitationDisplay,
					repeating_instantability_abilitytarget_show: switchToggleTarget,
					repeating_instantability_abilitytarget_display: targetDisplay,
					repeating_instantability_abilitycost_show: switchToggleCost,
					repeating_instantability_abilitycost_display: costDisplay,
					repeating_instantability_range_show: switchToggleRange,
					repeating_instantability_range_display: rangeDisplay,
					repeating_instantability_abilitycheck_show: switchToggleCheck,
					repeating_instantability_abilitycheck_display: checkDisplay,
					repeating_instantability_abilitycr_show: switchToggleCR,
					repeating_instantability_abilitycr_display: crDisplay,
					repeating_instantability_abilitybaseeffect_show: switchToggleBaseEffect,
					repeating_instantability_abilitybaseeffect_display: baseeffectDisplay,
					repeating_instantability_abilitydirecthit_show: switchToggleDirectHit,
					repeating_instantability_abilitydirecthit_display: directhitDisplay,
					repeating_instantability_trigger_show: switchToggleTrigger,
					repeating_instantability_abilitytrigger_display: triggerDisplay,
					repeating_instantability_abilityrequirement_show:switchToggleRequirement,
					repeating_instantability_abilityrequirement_display:requirementDisplay,
				});
		});
	});

	// Edit Button Functionality for Limit Break
	on("clicked:limitbreakedit", function() {
		getAttrs(["limitbreakswitch"], function(values) {
			let switchToggle = values.limitbreakswitch;
			switchToggle = 1 - switchToggle;
			setAttrs({
				limitbreakswitch: switchToggle,
				limitbreakcollapse: 1,
			});
		});
	});

	// String builder for Limit break
	on("clicked:limitbreakedit", function() {
		getAttrs([
		"limitbreakBaseEffectDie",
		"limitbreakDamageOrHealing",
		"limitbreakRollValue",
		"limitbreakTrigger",
		"limitbreakTarget",
		"limitbreakRange",
		"limitbreakBaseEffect",
		"limitbreakBaseEffectDie"
		], function(values) {
			var rollValue = "&{template:ffxivmain} {{header=limitbreak}} {{baseeffect=@{limitbreakBaseEffect} }} {{name=@{limitbreakName} }} {{tags=@{limitbreakTags} }}"

			if (values.limitbreakBaseEffectDie) {
				rollValue = rollValue.concat(" {{Attack = [[@{limitbreakBaseEffectDie}]]}} ")
				rollValue = rollValue.concat(" {{check=@{limitbreakDamageOrHealing} }} ")
			}

			// Trigger Display
			var triggerDisplay;
			var switchToggleTrigger;
			if (values.limitbreakTrigger) {
				triggerDisplay = values.limitbreakTrigger;
				switchToggleTrigger = "on"
			} else {
				switchToggleTrigger = 0;
			}

			// Target Display
			var targetDisplay;
			var switchToggleTarget;
			if (values.limitbreakTarget) {
				targetDisplay = values.limitbreakTarget;
				switchToggleTarget = "on"
			} else {
				switchToggleTarget = 0;
			}

			// Range Display
			var rangeDisplay;
			var switchToggleRange;
			if (values.limitbreakRange) {
				rangeDisplay = values.limitbreakRange;
				switchToggleRange = "on"
			} else {
				switchToggleRange = 0;
			}

			// BaseEffect Display
			var baseEffectDisplay;
			var switchToggleBaseEffect;
			if (values.limitbreakBaseEffect) {
				baseEffectDisplay = values.limitbreakBaseEffect;
				switchToggleBaseEffect = "on"
			} else {
				switchToggleBaseEffect = 0;
			}

			// BaseEffectDie Display
			var baseEffectDieDisplay;
			var switchToggleBaseEffectDie;
			if (values.limitbreakBaseEffectDie) {
				baseEffectDieDisplay = values.limitbreakBaseEffectDie;
				switchToggleBaseEffectDie = "on"
			} else {
				switchToggleBaseEffectDie = 0;
			}

			setAttrs({
				limitbreakRollValue: rollValue,
				limitbreaktrigger_show:switchToggleTrigger,
				limitbreaktrigger_display: triggerDisplay,
				limitbreaktarget_show:switchToggleTarget,
				limitbreaktarget_display: targetDisplay,
				limitbreakrange_show: switchToggleRange,
				limitbreakrange_display: rangeDisplay,
				limitbreakbaseeffect_show: switchToggleBaseEffect,
				limitbreakbaseeffect_display: baseEffectDisplay,
				limitbreakbaseeffectdie_show: switchToggleBaseEffectDie,
				limitbreakbaseeffectdie_display: baseEffectDieDisplay,
			});
		});
	})

	// Checkbox for Attack
	on("clicked:repeating_primaryability:attackcheckbox", function() {
		getAttrs(["repeating_primaryability_attackcheckbox"], function(values) {
			let switchToggle = values.repeating_primaryability_attackcheckbox;
			switchToggle = 1 - switchToggle;
			setAttrs({
				repeating_primaryability_attackcheckbox: switchToggle
			});
		});
	});

	// Toggle for Traits & Other Effects
	on("clicked:repeating_traits:traitedit", function() {
		getAttrs(["repeating_traits_traitswitch"], function(values) {
			let switchToggle = values.repeating_traits_traitswitch;
			switchToggle = 1 - switchToggle;
			setAttrs({
				repeating_traits_traitswitch: switchToggle
			});
		});
	});

	// On attribute change - Primary Ability
	on("change:repeating_primaryability:abilityselector", function() {
		getAttrs(["repeating_primaryability_abilityselector"], function(values) {
			let ability = values.repeating_primaryability_abilityselector;
			var newAbility;
			switch (ability) {
				case '1d20 + @{char_strength}':
					newAbility = "STR"
					break;
				case '1d20 + @{char_dexterity}':
					newAbility = "DEX"
					break;
				case '1d20 + @{char_vitality}':
					newAbility = "VIT"
					break;
				case '1d20 + @{char_intelligence}':
					newAbility = "INT"
					break;
				case '1d20 + @{char_mind}':
					newAbility = "MND"
					break;
				default:
					newAbility = "Special"
			}
			setAttrs({
				repeating_primaryability_abilitycheck: newAbility
			});
		});
	});

	// on Checkbox Check - Primary Ability
	on("change:repeating_primaryability:checkcheckbox", function() {
		getAttrs(["repeating_primaryability_checkcheckbox", "repeating_primaryability_abilityRollValue"], function(values) {
			let toggle = values.repeating_primaryability_checkcheckbox;
			let originalrollvalue = values.repeating_primaryability_abilityRollValue;
			var newrollvalue = checkboxStringEditor(toggle, originalrollvalue)

			setAttrs({
				repeating_primaryability_abilityRollValue: newrollvalue
			});
		});
	});

	// on DirectHit Check - Primary Ability
	on("change:repeating_primaryability:directhitcheckbox", function() {
		getAttrs(["repeating_primaryability_directhitcheckbox", "repeating_primaryability_abilityRollValue"], function(values) {
			let toggle = values.repeating_primaryability_directhitcheckbox;
			let originalrollvalue = values.repeating_primaryability_abilityRollValue;
			var newrollvalue = directHitStringEditor(toggle, originalrollvalue)

			setAttrs({
				repeating_primaryability_abilityRollValue: newrollvalue
			});
		});
	});

	// on Checkbox Check - Secondary Ability
	on("change:repeating_secondaryability:checkcheckbox", function() {
		getAttrs(["repeating_secondaryability_checkcheckbox", "repeating_secondaryability_abilityRollValue"], function(values) {
			let toggle = values.repeating_secondaryability_checkcheckbox;
			let originalrollvalue = values.repeating_secondaryability_abilityRollValue;
			var newrollvalue = checkboxStringEditor(toggle, originalrollvalue)

			setAttrs({
				repeating_secondaryability_abilityRollValue: newrollvalue
			});
		});
	});

	// on DirectHit Check - Secondary Ability
	on("change:repeating_secondaryability:directhitcheckbox", function() {
		getAttrs(["repeating_secondaryability_directhitcheckbox", "repeating_secondaryability_abilityRollValue"], function(values) {
			let toggle = values.repeating_secondaryability_directhitcheckbox;
			let originalrollvalue = values.repeating_secondaryability_abilityRollValue;
			var newrollvalue = directHitStringEditor(toggle, originalrollvalue)

			setAttrs({
				repeating_secondaryability_abilityRollValue: newrollvalue
			});
		});
	});

	// on Checkbox Check - Instant Ability
	on("change:repeating_instantability:checkcheckbox", function() {
		getAttrs(["repeating_instantability_checkcheckbox", "repeating_instantability_abilityRollValue"], function(values) {
			let toggle = values.repeating_instantability_checkcheckbox;
			let originalrollvalue = values.repeating_instantability_abilityRollValue;
			var newrollvalue = checkboxStringEditor(toggle, originalrollvalue)

			setAttrs({
				repeating_instantability_abilityRollValue: newrollvalue
			});
		});
	});

	// on Checkbox check - Limitbreak
	on("change:limitbreakBaseEffectDieCheckbox", function() {
		getAttrs(["limitbreakBaseEffectDieCheckbox", "limitbreakRollValue"], function(values) {
			let toggle = values.limitbreakBaseEffectDieCheckbox;
			let originalrollvalue = values.limitbreakRollValue;
			var newrollvalue;

			if (toggle == "on") {
				newrollvalue = originalrollvalue.concat("{{basedamage=[[@{limitbreakBaseEffectDie}]] }}")
			} else {
				newrollvalue = originalrollvalue.replace("{{basedamage=[[@{limitbreakBaseEffectDie}]] }}", "")
			}

			setAttrs({
				limitbreakRollValue: newrollvalue
			});
		});
	});

	// on DirectHit Check - Instant Ability
	on("change:repeating_instantability:directhitcheckbox", function() {
		getAttrs(["repeating_instantability_directhitcheckbox", "repeating_instantability_abilityRollValue"], function(values) {
			let toggle = values.repeating_instantability_directhitcheckbox;
			let originalrollvalue = values.repeating_instantability_abilityRollValue;
			var newrollvalue = directHitStringEditor(toggle, originalrollvalue)

			setAttrs({
				repeating_instantability_abilityRollValue: newrollvalue
			});
		});
	});

	// On attribute change - Secondary Ability
	on("change:repeating_secondaryability:abilityselector", function() {
		getAttrs(["repeating_secondaryability_abilityselector"], function(values) {
			let ability = values.repeating_secondaryability_abilityselector;
			var newAbility;
			switch (ability) {
				case '1d20 + @{char_strength}':
					newAbility = "STR"
					break;
				case '1d20 + @{char_dexterity}':
					newAbility = "DEX"
					break;
				case '1d20 + @{char_vitality}':
					newAbility = "VIT"
					break;
				case '1d20 + @{char_intelligence}':
					newAbility = "INT"
					break;
				case '1d20 + @{char_mind}':
					newAbility = "MND"
					break;
				default:
					newAbility = "Special"
			}
			setAttrs({
				repeating_secondaryability_abilitycheck: newAbility
			});
		});
	});

	// On attribute change - Instant Ability
	on("change:repeating_instantability:abilityselector", function() {
		getAttrs(["repeating_instantability_abilityselector"], function(values) {
			let ability = values.repeating_instantability_abilityselector;
			var newAbility;
			switch (ability) {
				case '1d20 + @{char_strength}':
					newAbility = "STR"
					break;
				case '1d20 + @{char_dexterity}':
					newAbility = "DEX"
					break;
				case '1d20 + @{char_vitality}':
					newAbility = "VIT"
					break;
				case '1d20 + @{char_intelligence}':
					newAbility = "INT"
					break;
				case '1d20 + @{char_mind}':
					newAbility = "MND"
					break;
				default:
					newAbility = "Special"
			}
			setAttrs({
				repeating_instantability_abilitycheck: newAbility
			});
		});
	});

	const buttonlist = ["character","abilities"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });

	function removeItemAll(arr, value) {
	  var i = 0;
	  while (i < arr.length) {
	    if (arr[i] === value) {
	      arr.splice(i, 1);
	    } else {
	      ++i;
	    }
	  }
	  return arr;
	}

	function checkboxStringEditor(toggle, original) {
		var newString;

		if (toggle == "on") {
			newString = original.concat("{{check=Ability Check }}")
		} else {
			newString = original.replace("{{check=Ability Check }}", "")
		}

		return newString;
	}

	function directHitStringEditor(toggle, original) {
		var newString;

		if (toggle == "on") {
			newString = original.concat("{{directdamage=[ROLL DIRECT HIT](~repeating_primaryability_directDamageRoll) }}")
		} else {
			newString = original.replace("{{directdamage=[ROLL DIRECT HIT](~repeating_primaryability_directDamageRoll) }}", "")
		}

		return newString;
	}
	

</script>
