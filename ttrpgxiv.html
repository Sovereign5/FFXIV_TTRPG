<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css?family=Bebas+Neue&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Romanesco&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Jura:wght@300..700&display=swap" rel="stylesheet">

<input type="text" name="attr_char_modifier" hidden>
<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab"  value="character"  />
<div class="sheetTabs">
    <button type="action" name="act_character" >Character</button>
    <button type="action" name="act_abilities" >Abilites</button>
</div>

<div class="sheet-mainpage">
	<div class="headerbar">
		<img src="https://raw.githubusercontent.com/Sovereign5/FFXIV_TTRPG/main/images/logo_text.png" />
		<div class="headerbar-right">
			<input type="text" name="attr_character_name" style="position: relative; font-size: 24px; font-family: Jura; background-color: transparent; appearance: none; border: none; color: white; width: 255px;">
			<hr style="width: 255px; position: relative; right: 150px; bottom: 24px; border-top: 2px solid white;">
		</div>
	</div>

	<!-- ROLE BAR + HP + MP -->
	<div class="rolebar">
		<div class="rolebar-left">
			<!-- ROLE SELECTION -->
			<div class="stacking-element-font" style="position: relative; top: 8px">
				<span style="position: relative; right: 60px">ROLE</span>
				<span style="position: relative; left: 15px;">JOB</span>
			</div>
			<div>
				<span style="position: relative; font-size: 20px;">LV</span>
				<input type="number" name="attr_char_level" step="10" min="0" max="50" style="position: relative; bottom: 6px; text-decoration: underline;">
				<select name="attr_class" style="position: relative; width: 280px; height: 40px; font-size: 24px; font-weight: 600;">
					<option style="color: black;" value="-1">Select</option>
					<option style="color: black;" value="Paladin">Tank / Paladin</option>
					<option style="color: black;" value="Warrior">Tank / Warrior</option>
					<option style="color: black;" value="DarkKnight">Tank / Dark Knight</option>
					<option style="color: black;" value="Gunbreaker">Tank / Gunbreaker</option>
					<option style="color: black;" value="WhiteMage">Healer / White Mage</option>
					<option style="color: black;" value="Scholar">Healer / Scholar</option>
					<option style="color: black;" value="Astrologian">Healer / Astrologian</option>
					<option style="color: black;" value="Sage">Healer / Sage</option>
					<option style="color: black;" value="Monk">DPS / Monk</option>
					<option style="color: black;" value="Dragoon">DPS / Dragoon</option>
					<option style="color: black;" value="Ninja">DPS / Ninja</option>
					<option style="color: black;" value="Samurai">DPS / Samurai</option>
					<option style="color: black;" value="Reaper">DPS / Reaper</option>
					<option style="color: black;" value="Bard">DPS / Bard</option>
					<option style="color: black;" value="Machinist">DPS / Machinist</option>
					<option style="color: black;" value="Dancer">DPS / Dancer</option>
					<option style="color: black;" value="BlackMage">DPS / Black Mage</option>
					<option style="color: black;" value="Summoner">DPS / Summoner</option>
					<option style="color: black;" value="RedMage">DPS / Red Mage</option>
					<option style="color: black;" value="BlueMage">DPS / Blue Mage</option>
				</select>
			</div>
			
		</div>

		<div class="rolebar-middle">
			<!-- HP BAR -->
			<span style="font-size: 2em; position: relative; left: 18px">HP</span>
			<input type="number" name="attr_char_HP" min="0" style="position: relative; left: 18px; width: 80px; height: 60px; font-size: 50px;">
			<span class="dividing-line" style="position: relative;">/</span>
			<div class="stacking-element">
				<span class="stacking-element-font" style="position: relative; right: 8px">MAX</span>
				<input type="number" name="attr_char_maxHP" min="0" style="position: relative; left: 2px">
			</div>
			<span class="dividing-line" style="position: relative; right: 13px">|</span>
			<div class="stacking-element">
				<span class="stacking-element-font" style="position: relative; right: 12px">BARRIER</span>
				<input type="number" name="attr_char_tempHP" min="0" style="position: relative; left: 5px;">
			</div>
		</div>

		<div class="rolebar-right">
			<!-- MP BAR -->
			<span style="font-size: 2em;">MP</span>
			<input type="number" name="attr_char_MP" min="0" max="5" style="position: relative; width: 45px; height: 60px; font-size: 50px;"/>
			<span class="dividing-line" style="position: relative; right: 13px">/</span>
			<div class="stacking-element" style="position: relative; right: 5px">
				<span class="stacking-element-font">MAX</span>
				<span>5</span>
			</div>
		</div>
	</div>
	<!-- END OF ROLE BAR + HP + MP -->

	<!-- THE BODY -->
	<div class="body">
		<div class="body-left">
			<div class="grid-item" style="position: relative; top: 13px;">
				<label>Main Status</label>
				<hr style="position: relative; bottom: 19px;">
			</div>
			<div class="grid-item" style="position: relative; top: 13px;">
				<label>Sub Status</label>
				<hr style="position: relative; bottom: 19px; width: 88%; right: 10px;">
			</div>
			<div class="grid-item">
				<div class="grid-rollable">
					<span>STR</span>
					<input type="number" name="attr_char_strength">
					<button type='roll' value="&{template:ffxivmain} {{header=attribute}} {{name=Strength}} {{check=Attribute Check}} {{Attribute=[[1d20 + @{char_strength}]] }}" name=roll_strCheck></button>
					<hr>
				</div>
			</div>
			<div class="grid-item">
				<span class="span-longer">Defense</span>
				<input class="input-shorter" type="number" name="attr_physical_defense" value="10">
				<hr style="width: 88%; position: relative; right: 10px; bottom: 25px;">
			</div>
			<div class="grid-item">
				<div class="grid-rollable">
					<span>DEX</span>
					<input type="number" name="attr_char_dexterity">
					<button type='roll' value="&{template:ffxivmain} {{header=attribute}} {{name=Dexterity}} {{check=Attribute Check}} {{Attribute=[[1d20 + @{char_dexterity}]] }}" name=roll_dexCheck></button>
					<hr>
				</div>
			</div>
			<div class="grid-item">
				<span class="span-longer">M. Defense</span>
				<input class="input-shorter" type="number" name="attr_magical_defense" value="10">
				<hr style="width: 88%; position: relative; right: 10px; bottom: 25px;">
			</div>
			<div class="grid-item">
				<div class="grid-rollable">
					<span>VIT</span>
					<input type="number" name="attr_char_vitality">
					<button type='roll' value="&{template:ffxivmain} {{header=attribute}} {{name=Vitality}} {{check=Attribute Check}} {{Attribute=[[1d20 + @{char_vitality}]] }}" name=roll_vitCheck></button>
					<hr>
				</div>
			</div>
			<div class="grid-item">
				<span class="span-longer">Vigilance</span>
				<input class="input-shorter" type="number" name="attr_char_vigilance" />
				<hr style="width: 88%; position: relative; right: 10px; bottom: 25px;">
			</div>
			<div class="grid-item">
				<div class="grid-rollable">
					<span>INT</span>
					<input type="number" name="attr_char_intelligence">
					<button type='roll' value="&{template:ffxivmain} {{header=attribute}} {{name=Intelligence}} {{check=Attribute Check}} {{Attribute=[[1d20 + @{char_intelligence}]] }}" name=roll_intCheck></button>
					<hr>
				</div>
			</div>
			<div class="grid-item">
				<span class="span-longer" style="width: 55px">Speed</span>
				<span class="input-shorter" style="position: relative; right: 10px">5</span>
				<span class="input-shorter" style="font-size: 14px; position: relative; right:15px">squares</span>
				<hr style="width: 88%; position: relative; right: 10px; bottom: 24px;">
			</div>
			<div class="grid-item">
				<div class="grid-rollable">
					<span>MND</span>
					<input type="number" name="attr_char_mind">
					<button type='roll' value="&{template:ffxivmain} {{header=attribute}} {{name=Mind}} {{check=Attribute Check}} {{Attribute=[[1d20 + @{char_mind}]] }}" name=roll_mndCheck></button>
					<hr>
				</div>
			</div>
			<!-- Purposefully Left Empty for Spacing -->
			<div class="grid-item"></div>
		</div>
		<div class="body-right">
			<label>Traits & Other Effects</label>
			<fieldset class="repeating_traits">
				<div class="traitdiv">
					<input type="checkbox" name="attr_traitswitch" class="sheet-traits-switch" value="1" hidden>
					<button type="action" name="act_traitedit" class="edittraitbutton"><span style="font-family:Pictos;">y</span></button>
					<div class="sheet-traits-hide">
						<span>Name:</span> <input type="text" name="attr_traitname"><br>
						<span>Effect:</span> <input type="text" name="attr_traiteffect"><br>
						<span>Description</span>
					<textarea name="attr_traitdescription"></textarea>
					</div>



					<div class="sheet-traits-show">
						<div class="traits-headerbar" style="display: flex;">
							<div style="width: 48%;">
								<button type='roll' value="&{template:info} {{name=@{traitname} }} {{trait=@{traiteffect} }} {{desc=@{traitdescription} }}" name="roll_traitdisplay" style="position: relative; top: -2px;" class="traitdisplay"><span name="attr_traitname" style="text-align: right; width: 50%;"></span>
								</button>
							</div>
							<div style="width: 48%; text-align: right;">
								<span name="attr_traiteffect"></span>
							</div>
						</div>
						<span name="attr_traitdescription"></span>
					</div>	
				</div>
			</fieldset>
		</div>
	</div>
</div>




<!-- SECOND PAGE - ABILITIES -->
<div class=sheet-abilitiespage>
	<div class=ability-limitbreak>
		<label>LIMIT BREAK</label>
		<input type="checkbox" name="attr_limitbreakTargetCheckbox" class="sheet-limitbreaktargetcheckbox" hidden>
		<input type="checkbox" name="attr_limitbreakRangeCheckbox" class="sheet-limitbreakrangecheckbox" hidden>
		<div>
			<!-- GLOBAL VARIABLES LIMIT BREAK --> 
			<input type="checkbox" name="attr_limitbreakswitch" class="sheet-limitbreak-switch" value="0" hidden>
			<button type="action" name="act_limitbreakedit" class="editlimitbreakbutton"><span style="font-family:Pictos;">y</span></button>


			<!-- DISPLAY MODE LIMIT BREAK -->
			<div class="sheet-limitbreak-a">
				<button type="roll" class="sheet-diceroll" style="top: 20px; left: -10px;font-size: 2em;" value="&{template:ffxivmain} {{header=primary}} {{baseeffect=@{limitbreakBaseEffect} }} {{name=@{limitbreakName} }} {{tags=Limit Break}} {{basedamage=[[@{limitbreakBaseEffectDie}]] }}" name="roll_limitbreakdie"> <span name="attr_limitbreakName"></span> </button><br>
				<div class="displaymode">
					<span style="font-weight: 700;">Trigger:</span>
					<span name="attr_limitbreakTrigger" class="sheet-limitbreakTriggerField"></span>
				</div>
				<div class="displaymode">
					<input type="checkbox" name="attr_limitbreakTargetCheckbox" class="sheet-limitbreaktargetcheckbox" hidden>
					<span style="font-weight: 700;" class="sheet-limitbreakTargetField">Target:</span>
					<span name="attr_limitbreakTarget" class="sheet-limitbreakTargetField"></span>
				</div>
				<div class="displaymode">
					<input type="checkbox" name="attr_limitbreakRangeCheckbox" class="sheet-limitbreakrangecheckbox" hidden>
					<span style="font-weight: 700;" class="sheet-limitbreakRangeField">Range:</span>
					<span name="attr_limitbreakRange" class="sheet-limitbreakRangeField"></span>
				</div>
				<div class="displaymode">
					<span style="font-weight: 700;">Base Effect: </span>
					<span name="attr_limitbreakBaseEffect"></span>
				</div>
			</div>


			<!-- EDIT MODE LIMIT BREAK -->
			<div class="sheet-limitbreak-b">
				<span>Name: </span> <input type="text" name="attr_limitbreakName"><br>
				<span>Trigger: </span> <input type="text" name="attr_limitbreakTrigger"><br>

				<input type="checkbox" name="attr_limitbreakTargetCheckbox" class="sheet-limitbreaktargetcheckbox"> <span>Target: </span>
				<input type="text" name="attr_limitbreakTarget"><br>

				<input type="checkbox" name="attr_limitbreakRangeCheckbox" class="sheet-limitbreakrangecheckbox"> <span>Range: </span> 
				<input type="text" name="attr_limitbreakRange"><br>

				<span> Base Effect: </span> <textarea name="attr_limitbreakBaseEffect"></textarea>

				<input type="checkbox" name="attr_limitbreakBaseEffectDieCheckbox" class="sheet-limitbreakbaseeffectdie"> <span>Base Effect Dice: </span>
				<input type="text" name="attr_limitbreakBaseEffectDie"><br>
				<span></span>
			</div>
		</div>
	</div>

	<div class="sheet-abilities">
		<div class=abilities-primary>
			<label>PRIMARY ABILITIES</label>
			<fieldset class=repeating_primaryability>
				<input type="checkbox" name="attr_requirementcheckbox" class="sheet-requirementcheckbox" hidden>
				<input type="checkbox" name="attr_triggercheckbox" class="sheet-triggercheckbox" hidden>
				<input type="checkbox" class="sheet-block-switch" name="attr_blockswitch" value="1" hidden>
				<input type="checkbox" name="attr_costcheckbox" class="sheet-costcheckbox" hidden>
				<input type="checkbox" name="attr_targetcheckbox" class="sheet-targetcheckbox" hidden>
				<input type="checkbox" name="attr_rangecheckbox" class="sheet-rangecheckbox" hidden>
				<input type="checkbox" name="attr_checkcheckbox" class="sheet-checkcheckbox" hidden>
				<input type="checkbox" name="attr_crcheckbox" class="sheet-crcheckbox" hidden>
				<input type="checkbox" name="attr_directhitcheckbox" class="sheet-directeffectcheckbox" hidden>
				<input type="text" name="attr_abilityRollValue" value="&{template:ffxivmain} {{header=primary}} {{baseeffect=@{abilitybaseeffect} }} {{rolltype=@{abilitycheck} }} {{damagetype=@{abilitybaseeffectdamageorhealing} }} {{name=@{abilityname} }} {{tags=@{abilitytags} }} {{basedamage=[[@{abilitybaseeffectdamage}]] }}  {{effect=@{abilitybaseeffectextraeffect} }} {{Attack = [[@{abilityselector}]]}}" hidden>
				

				<button type="action" class="toggle_repeating_npcaction_edit" name="act_edit"><span style="font-family:Pictos;">y</button><br>

				<!-- EDITING MODE - PRIMARY ABILITIES -->
				<div class="sheet-block-a" style="padding: 3px;">
					<span>Ability Name</span>
					<input type="text" name="attr_abilityname" placeholder="Storm's Path" required>
					<br>

					<span>Ability Tags</span>
					<input type="text" name="attr_abilitytags" placeholder="Primary, Physical">
					<br>

					<input type="checkbox" name="attr_requirementcheckbox" class="sheet-requirementcheckbox"> <span>Requirement</span>
					<input type="text" name="attr_abilityrequirement">
					<br>
					<input type="checkbox" name="attr_triggercheckbox" class="sheet-triggercheckbox"> <span>Trigger</span>
					<input type="text" name="attr_abilitytrigger" placeholder="When an enemy within 10 squares begins their turn.">
					<br>

					<input type="checkbox" name="attr_costcheckbox" class="sheet-costcheckbox"> <span>Cost</span>
					<input type="text" name="attr_abilitycost" placeholder="1 MP">
					<br>

					<input type="checkbox" name="attr_targetcheckbox" class="sheet-targetcheckbox"> <span>Target</span>
					<input type="text" name="attr_abilitytarget" placeholder="Single">
					<br>

					<input type="checkbox" name="attr_rangecheckbox" class="sheet-rangecheckbox"> <span>Range</span>
					<input type="text" name="attr_abilityrange" placeholder="5 Squares">
					<br>

					<input type="checkbox" name="attr_checkcheckbox" class="sheet-checkcheckbox"> <span>Check</span>
					<input type="text" name="attr_abilitycheck" hidden>
					<select class="sheet-checkcheckbox" name="attr_abilityselector">
						<option value="1d20">Special</option>
						<option value="1d20 + @{char_strength}">STR</option>
						<option value="1d20 + @{char_dexterity}">DEX</option>
						<option value="1d20 + @{char_intelligence}">INT</option>
						<option value="1d20 + @{char_mind}">MND</option>
					</select>
					<br>
					<input type="checkbox" name="attr_crcheckbox" class="sheet-crcheckbox"> <span>CR</span>
					<input type="text" name="attr_abilitycr" placeholder="Target's Defense">
					<br>
					<span>Base Effect</span>
					<input type="text" name="attr_abilitybaseeffect" placeholder="Deals 3 damage to the target" required>
					<br>

					<input type="checkbox" name="attr_baseeffectdamagecheckbox"> <span>Base Effect</span>
					<div style="display: flex;">
						<input type="text" name="attr_abilitybaseeffectdamage" value="0" placeholder="1d6" required>
						<span>+</span>
						<input type="text" name="attr_abilitybaseeffectmodifier" placeholder="0">
						<span>=</span>
						<!-- <input type="text" name="attr_abilitybaseeffectdamageorhealing"> -->
						<select name="attr_abilitybaseeffectdamageorhealing">
							<option value="Damage">Damage</option>
							<option value="Healing">Healing</option>
						</select>
					</div>
					<br>

					<input type="checkbox" name="attr_baseeffectextraeffect"> <span>Base Effect Extra Effect</span>
					<input type="text" name="attr_abilitybaseeffectextraeffect" placeholder="Combo: Storm's Path">
					<br>

					<input type="checkbox" name="attr_directhitcheckbox" class="sheet-directeffectcheckbox"> <span>Direct Hit</span>
					<input type="text" name="attr_abilitydirecthit" placeholder="Deals an additional 2d6 damage">
					<br>

					<input type="checkbox" name="attr_directhitdamagecheckbox"> <span>Direct Hit Damage</span>
					<div style="display: flex;">
						<input type="text" name="attr_abilitydirecthitdamage" value="0" placeholder="2d6" required>
						<span>+</span>
						<input type="text" name="attr_abilitydirecteffectmodifier" placeholder="0">
						<span>=</span>
						<select name="attr_abilitydirecteffectdamageorhealing">
							<option value="Damage">Damage</option>
							<option value="Healing">Healing</option>
						</select>
					</div>
					<br>

					<input type="checkbox" name="attr_directhitextraeffect"> <span>Direct Hit Extra Effect</span>
					<input type="text" name="attr_abilitydirecthitextraeffect" placeholder="Generates Emnity">
				</div>

				<!-- DISPLAY MODE - PRIMARY ABILITIES -->
				<div class="sheet-block-b" style="padding: 3px;">
					<button type="roll" class="sheet-diceroll" value="@{abilityRollValue}" name="roll_abilityCheck"> <span name="attr_abilityname"></span> </button><br>
					<span name="attr_abilitytags" style="font-style: italic;"></span>
					<div class="displaymode">
						<input type="checkbox" name="attr_requirementcheckbox" class="sheet-requirementcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-requirementfield">Requirement:</span>
						<span name="attr_abilityrequirement" class="sheet-requirementfield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_triggercheckbox" class="sheet-triggercheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-triggerfield">Trigger: </span>
						<span name="attr_abilitytrigger" class="sheet-triggerfield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_costcheckbox" class="sheet-costcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-costfield">Cost: </span>
						<span name="attr_abilitycost" class="sheet-costfield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_targetcheckbox" class="sheet-targetcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-targetfield">Target: </span>
						<span name="attr_abilitytarget" class="sheet-targetfield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_rangecheckbox" class="sheet-rangecheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-rangefield">Range: </span>
						<span name="attr_abilityrange" class="sheet-rangefield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_checkcheckbox" class="sheet-checkcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-checkfield">Check: </span>
						<span name="attr_abilitycheck" class="sheet-checkfield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_crcheckbox" class="sheet-crcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-crfield">CR: </span>
						<span name="attr_abilitycr" class="sheet-crfield"></span>
					</div>
					<div class="displaymode">
						<span style="font-weight: 700;">Base Effect: </span>
						<span name="attr_abilitybaseeffect"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_directhitcheckbox" class="sheet-directeffectcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-directeffectfield">Direct Hit Effect: </span>
						<span name="attr_abilitydirecthit" class="sheet-directeffectfield"></span>
					</div>
					<button class="hide" type="roll" name="roll_directDamageRoll" value="&{template:ffxivdamage} {{name=@{abilityname} }} {{Attack = [[@{abilitydirecthitdamage}]] }}">Hide</button>
				</div>
			</fieldset>
		</div>




		<div class=abilities-secondary>
			<label>SECONDARY ABILITIES</label>
			<fieldset class=repeating_secondaryability>
				<input type="checkbox" name="attr_requirementcheckbox" class="sheet-requirementcheckbox" hidden>
				<input type="checkbox" name="attr_triggercheckbox" class="sheet-triggercheckbox" hidden>
				<input type="checkbox" class="sheet-block-switch" name="attr_blockswitch" value="1" hidden>
				<input type="checkbox" name="attr_costcheckbox" class="sheet-costcheckbox" hidden>
				<input type="checkbox" name="attr_targetcheckbox" class="sheet-targetcheckbox" hidden>
				<input type="checkbox" name="attr_rangecheckbox" class="sheet-rangecheckbox" hidden>
				<input type="checkbox" name="attr_checkcheckbox" class="sheet-checkcheckbox" hidden>
				<input type="checkbox" name="attr_crcheckbox" class="sheet-crcheckbox" hidden>
				<input type="checkbox" name="attr_directhitcheckbox" class="sheet-directeffectcheckbox" hidden>
				<input type="text" name="attr_abilityRollValue" value="&{template:ffxivmain} {{header=secondary}} {{baseeffect=@{abilitybaseeffect} }} {{rolltype=@{abilitycheck} }} {{damagetype=@{abilitybaseeffectdamageorhealing} }} {{name=@{abilityname} }} {{tags=@{abilitytags} }} {{basedamage=[[@{abilitybaseeffectdamage}]] }}  {{effect=@{abilitybaseeffectextraeffect} }} {{Attack = [[@{abilityselector}]]}}" hidden>
				

				<button type="action" class="toggle_repeating_npcaction_edit" name="act_edit"><span style="font-family:Pictos;">y</button><br>

				<!-- EDITING MODE - SECONDARY ABILITIES -->
				<div class="sheet-block-a" style="padding: 3px;">
						<span>Ability Name</span>
					<input type="text" name="attr_abilityname" placeholder="Storm's Path" required>
					<br>

					<span>Ability Tags</span>
					<input type="text" name="attr_abilitytags" placeholder="Primary, Physical">
					<br>

					<input type="checkbox" name="attr_requirementcheckbox" class="sheet-requirementcheckbox"> <span>Requirement</span>
					<input type="text" name="attr_abilityrequirement">
					<br>
					<input type="checkbox" name="attr_triggercheckbox" class="sheet-triggercheckbox"> <span>Trigger</span>
					<input type="text" name="attr_abilitytrigger" placeholder="When an enemy within 10 squares begins their turn.">
					<br>

					<input type="checkbox" name="attr_costcheckbox" class="sheet-costcheckbox"> <span>Cost</span>
					<input type="text" name="attr_abilitycost" placeholder="1 MP">
					<br>

					<input type="checkbox" name="attr_targetcheckbox" class="sheet-targetcheckbox"> <span>Target</span>
					<input type="text" name="attr_abilitytarget" placeholder="Single">
					<br>

					<input type="checkbox" name="attr_rangecheckbox" class="sheet-rangecheckbox"> <span>Range</span>
					<input type="text" name="attr_abilityrange" placeholder="5 Squares">
					<br>

					<input type="checkbox" name="attr_checkcheckbox" class="sheet-checkcheckbox"> <span>Check</span>
					<input type="text" name="attr_abilitycheck" hidden>
					<select class="sheet-checkcheckbox" name="attr_abilityselector">
						<option value="1d20">Special</option>
						<option value="1d20 + @{char_strength}">STR</option>
						<option value="1d20 + @{char_dexterity}">DEX</option>
						<option value="1d20 + @{char_intelligence}">INT</option>
						<option value="1d20 + @{char_mind}">MND</option>
					</select>
					<br>
					<input type="checkbox" name="attr_crcheckbox" class="sheet-crcheckbox"> <span>CR</span>
					<input type="text" name="attr_abilitycr" placeholder="Target's Defense">
					<br>
					<span>Base Effect</span>
					<input type="text" name="attr_abilitybaseeffect" placeholder="Deals 3 damage to the target" required>
					<br>

					<input type="checkbox" name="attr_baseeffectdamagecheckbox"> <span>Base Effect</span>
					<div style="display: flex;">
						<input type="text" name="attr_abilitybaseeffectdamage" value="0" placeholder="1d6" required>
						<span>+</span>
						<input type="text" name="attr_abilitybaseeffectmodifier" placeholder="0">
						<span>=</span>
						<!-- <input type="text" name="attr_abilitybaseeffectdamageorhealing"> -->
						<select name="attr_abilitybaseeffectdamageorhealing">
							<option value="Damage">Damage</option>
							<option value="Healing">Healing</option>
						</select>
					</div>
					<br>

					<input type="checkbox" name="attr_baseeffectextraeffect"> <span>Base Effect Extra Effect</span>
					<input type="text" name="attr_abilitybaseeffectextraeffect" placeholder="Combo: Storm's Path">
					<br>

					<input type="checkbox" name="attr_directhitcheckbox" class="sheet-directeffectcheckbox"> <span>Direct Hit</span>
					<input type="text" name="attr_abilitydirecthit" placeholder="Deals an additional 2d6 damage">
					<br>

					<input type="checkbox" name="attr_directhitdamagecheckbox"> <span>Direct Hit Damage</span>
					<div style="display: flex;">
						<input type="text" name="attr_abilitydirecthitdamage" value="0" placeholder="2d6" required>
						<span>+</span>
						<input type="text" name="attr_abilitydirecteffectmodifier" placeholder="0">
						<span>=</span>
						<select name="attr_abilitydirecteffectdamageorhealing">
							<option value="Damage">Damage</option>
							<option value="Healing">Healing</option>
						</select>
					</div>
					<br>

					<input type="checkbox" name="attr_directhitextraeffect"> <span>Direct Hit Extra Effect</span>
					<input type="text" name="attr_abilitydirecthitextraeffect" placeholder="Generates Emnity">
				</div>

				<!-- DISPLAY MODE - SECONDARY ABILITIES -->
				<div class="sheet-block-b" style="padding: 3px;">
					<button type="roll" class="sheet-diceroll" value="@{abilityRollValue}" name="roll_abilityCheck"> <span name="attr_abilityname"></span> </button><br>
					<span name="attr_abilitytags" style="font-style: italic;"></span>
					<div class="displaymode">
						<input type="checkbox" name="attr_requirementcheckbox" class="sheet-requirementcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-requirementfield">Requirement:</span>
						<span name="attr_abilityrequirement" class="sheet-requirementfield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_triggercheckbox" class="sheet-triggercheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-triggerfield">Trigger: </span>
						<span name="attr_abilitytrigger" class="sheet-triggerfield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_costcheckbox" class="sheet-costcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-costfield">Cost: </span>
						<span name="attr_abilitycost" class="sheet-costfield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_targetcheckbox" class="sheet-targetcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-targetfield">Target: </span>
						<span name="attr_abilitytarget" class="sheet-targetfield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_rangecheckbox" class="sheet-rangecheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-rangefield">Range: </span>
						<span name="attr_abilityrange" class="sheet-rangefield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_checkcheckbox" class="sheet-checkcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-checkfield">Check: </span>
						<span name="attr_abilitycheck" class="sheet-checkfield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_crcheckbox" class="sheet-crcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-crfield">CR: </span>
						<span name="attr_abilitycr" class="sheet-crfield"></span>
					</div>
					<div class="displaymode">
						<span style="font-weight: 700;">Base Effect: </span>
						<span name="attr_abilitybaseeffect"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_directhitcheckbox" class="sheet-directeffectcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-directeffectfield">Direct Hit Effect: </span>
						<span name="attr_abilitydirecthit" class="sheet-directeffectfield"></span>
					</div>
					<button class="hide" type="roll" name="roll_directDamageRoll" value="&{template:ffxivdamage} {{name=@{abilityname} }} {{Attack = [[@{abilitydirecthitdamage}]] }}">Hide</button>
				</div>
			</fieldset>
		</div>





		<div class="abilities-instant">
			<label>INSTANT ABILITIES</label>
			<fieldset class="repeating_instantability">
				<input type="checkbox" name="attr_requirementcheckbox" class="sheet-requirementcheckbox" hidden>
				<input type="checkbox" name="attr_triggercheckbox" class="sheet-triggercheckbox" hidden>
				<input type="checkbox" class="sheet-block-switch" name="attr_blockswitch" value="1" hidden>
				<input type="checkbox" name="attr_costcheckbox" class="sheet-costcheckbox" hidden>
				<input type="checkbox" name="attr_targetcheckbox" class="sheet-targetcheckbox" hidden>
				<input type="checkbox" name="attr_rangecheckbox" class="sheet-rangecheckbox" hidden>
				<input type="checkbox" name="attr_checkcheckbox" class="sheet-checkcheckbox" hidden>
				<input type="checkbox" name="attr_crcheckbox" class="sheet-crcheckbox" hidden>
				<input type="checkbox" name="attr_directhitcheckbox" class="sheet-directeffectcheckbox" hidden>
				<input type="text" name="attr_abilityRollValue" value="&{template:ffxivmain} {{header=instant}} {{baseeffect=@{abilitybaseeffect} }} {{rolltype=@{abilitycheck} }} {{damagetype=@{abilitybaseeffectdamageorhealing} }} {{name=@{abilityname} }} {{tags=@{abilitytags} }} {{basedamage=[[@{abilitybaseeffectdamage}]] }}  {{effect=@{abilitybaseeffectextraeffect} }} {{Attack = [[@{abilityselector}]]}}" hidden>
				

				<button type="action" class="toggle_repeating_npcaction_edit" name="act_edit"><span style="font-family:Pictos;">y</button><br>

				<!-- EDITING MODE - INSTANT ABILITIES -->
				<div class="sheet-block-a" style="padding: 3px;">
						<span>Ability Name</span>
					<input type="text" name="attr_abilityname" placeholder="Storm's Path" required>
					<br>

					<span>Ability Tags</span>
					<input type="text" name="attr_abilitytags" placeholder="Primary, Physical">
					<br>

					<input type="checkbox" name="attr_requirementcheckbox" class="sheet-requirementcheckbox"> <span>Requirement</span>
					<input type="text" name="attr_abilityrequirement">
					<br>
					<input type="checkbox" name="attr_triggercheckbox" class="sheet-triggercheckbox"> <span>Trigger</span>
					<input type="text" name="attr_abilitytrigger" placeholder="When an enemy within 10 squares begins their turn.">
					<br>

					<input type="checkbox" name="attr_costcheckbox" class="sheet-costcheckbox"> <span>Cost</span>
					<input type="text" name="attr_abilitycost" placeholder="1 MP">
					<br>

					<input type="checkbox" name="attr_targetcheckbox" class="sheet-targetcheckbox"> <span>Target</span>
					<input type="text" name="attr_abilitytarget" placeholder="Single">
					<br>

					<input type="checkbox" name="attr_rangecheckbox" class="sheet-rangecheckbox"> <span>Range</span>
					<input type="text" name="attr_abilityrange" placeholder="5 Squares">
					<br>

					<input type="checkbox" name="attr_checkcheckbox" class="sheet-checkcheckbox"> <span>Check</span>
					<input type="text" name="attr_abilitycheck" hidden>
					<select class="sheet-checkcheckbox" name="attr_abilityselector">
						<option value="1d20">Special</option>
						<option value="1d20 + @{char_strength}">STR</option>
						<option value="1d20 + @{char_dexterity}">DEX</option>
						<option value="1d20 + @{char_intelligence}">INT</option>
						<option value="1d20 + @{char_mind}">MND</option>
					</select>
					<br>
					<input type="checkbox" name="attr_crcheckbox" class="sheet-crcheckbox"> <span>CR</span>
					<input type="text" name="attr_abilitycr" placeholder="Target's Defense">
					<br>
					<span>Base Effect</span>
					<input type="text" name="attr_abilitybaseeffect" placeholder="Deals 3 damage to the target" required>
					<br>

					<input type="checkbox" name="attr_baseeffectdamagecheckbox"> <span>Base Effect</span>
					<div style="display: flex;">
						<input type="text" name="attr_abilitybaseeffectdamage" value="0" placeholder="1d6" required>
						<span>+</span>
						<input type="text" name="attr_abilitybaseeffectmodifier" placeholder="0">
						<span>=</span>
						<!-- <input type="text" name="attr_abilitybaseeffectdamageorhealing"> -->
						<select name="attr_abilitybaseeffectdamageorhealing">
							<option value="Damage">Damage</option>
							<option value="Healing">Healing</option>
						</select>
					</div>
					<br>

					<input type="checkbox" name="attr_baseeffectextraeffect"> <span>Base Effect Extra Effect</span>
					<input type="text" name="attr_abilitybaseeffectextraeffect" placeholder="Combo: Storm's Path">
					<br>

					<input type="checkbox" name="attr_directhitcheckbox" class="sheet-directeffectcheckbox"> <span>Direct Hit</span>
					<input type="text" name="attr_abilitydirecthit" placeholder="Deals an additional 2d6 damage">
					<br>

					<input type="checkbox" name="attr_directhitdamagecheckbox"> <span>Direct Hit Damage</span>
					<div style="display: flex;">
						<input type="text" name="attr_abilitydirecthitdamage" value="0" placeholder="2d6" required>
						<span>+</span>
						<input type="text" name="attr_abilitydirecteffectmodifier" placeholder="0">
						<span>=</span>
						<select name="attr_abilitydirecteffectdamageorhealing">
							<option value="Damage">Damage</option>
							<option value="Healing">Healing</option>
						</select>
					</div>
					<br>

					<input type="checkbox" name="attr_directhitextraeffect"> <span>Direct Hit Extra Effect</span>
					<input type="text" name="attr_abilitydirecthitextraeffect" placeholder="Generates Emnity">
				</div>

				<!-- DISPLAY MODE - INSTANT ABILITIES -->
				<div class="sheet-block-b" style="padding: 3px;">
					<button type="roll" class="sheet-diceroll" value="@{abilityRollValue}" name="roll_abilityCheck"> <span name="attr_abilityname"></span> </button><br>
					<span name="attr_abilitytags" style="font-style: italic;"></span>
					<div class="displaymode">
						<input type="checkbox" name="attr_requirementcheckbox" class="sheet-requirementcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-requirementfield">Requirement:</span>
						<span name="attr_abilityrequirement" class="sheet-requirementfield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_triggercheckbox" class="sheet-triggercheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-triggerfield">Trigger: </span>
						<span name="attr_abilitytrigger" class="sheet-triggerfield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_costcheckbox" class="sheet-costcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-costfield">Cost: </span>
						<span name="attr_abilitycost" class="sheet-costfield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_targetcheckbox" class="sheet-targetcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-targetfield">Target: </span>
						<span name="attr_abilitytarget" class="sheet-targetfield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_rangecheckbox" class="sheet-rangecheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-rangefield">Range: </span>
						<span name="attr_abilityrange" class="sheet-rangefield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_checkcheckbox" class="sheet-checkcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-checkfield">Check: </span>
						<span name="attr_abilitycheck" class="sheet-checkfield"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_crcheckbox" class="sheet-crcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-crfield">CR: </span>
						<span name="attr_abilitycr" class="sheet-crfield"></span>
					</div>
					<div class="displaymode">
						<span style="font-weight: 700;">Base Effect: </span>
						<span name="attr_abilitybaseeffect"></span>
					</div>
					<div class="displaymode">
						<input type="checkbox" name="attr_directhitcheckbox" class="sheet-directeffectcheckbox" hidden>
						<span style="font-weight: 700;" class="sheet-directeffectfield">Direct Hit Effect: </span>
						<span name="attr_abilitydirecthit" class="sheet-directeffectfield"></span>
					</div>
					<button class="hide" type="roll" name="roll_directDamageRoll" value="&{template:ffxivdamage} {{name=@{abilityname} }} {{Attack = [[@{abilitydirecthitdamage}]] }}">Hide</button>
				</div>
			</fieldset>		
		</div>
	</div>
</div>

<!-- PRIMARY ROLL TEMPLATE -->
<rolltemplate class="sheet-rolltemplate-ffxivmain">
	<div class="sheet-template-container">

		<!-- Primary Roll Template Header -->
		<div class="sheet-template-masterheader-{{header}}">
			<div class=sheet-template-header>
				{{#name}}
				<div class="sheet-header">{{name}}</div>
				{{/name}}
			</div>
			<div class="sheet-template-row">
				{{#tags}}
				<div class="sheet-tags">{{tags}}</div>
				{{/tags}}
			</div>
		</div>
		<hr class="sheet-line">


		<!-- Primary Roll Template Base Effect -->
		{{#baseeffect}}
		<div class="sheet-info-larger">{{baseeffect}}</div>
		{{/baseeffect}}


		<!-- Primary Roll Template Check -->
		{{#check}}
		<div class="sheet-template-header">
			{{#allprops() rolltype name tags basedamage directdamage effect baseeffect check damagetype header}}
    		<div class="sheet-value">{{value}}</div>
 			{{/allprops() rolltype name tags basedamage directdamage effect baseeffect check damagetype header}}
 			<div class="sheet-info">
 				<span>{{check}}</span>
 			</div>
		</div>
		{{/check}}

		{{#basedamage}}
		<hr class="sheet-line">
		<div class="sheet-template-header">
			<div class="sheet-value">
				<span class="inlinerollresult" style="color:white;font-family: 'Bebas Neue, sans-serif';padding-bottom:'2px">{{basedamage}}</span>
			</div>
			{{#damagetype}}
			<div class="sheet-info">
				<span>{{damagetype}}</span>
			</div>
			{{/damagetype}}
		</div>
		{{/basedamage}}
		{{#effect}}
		<div class="sheet-template-row">
			<div class="sheet-tags">{{effect}}</div>
		</div>
		{{/effect}}

		{{#directdamage}}
		<hr class="sheet-line">
			{{directdamage}}
		{{/directdamage}}

	</div>
</rolltemplate>

<!-- DAMAGE ROLL TEMPLATE -->
<rolltemplate class="sheet-rolltemplate-ffxivdamage">
	<div class="sheet-template-container">
		<div class="sheet-template-header">
			{{#name}}
			<div class="sheet-header">{{name}}</div>
			{{/name}}
		</div>
		<div class="sheet-template-row">
			<div class="sheet-tags">DIRECT HIT</div>
		</div>
		<hr class="sheet-line">
		<div class="sheet-template-header">
			{{#allprops() name}}
			<div class="sheet-value">{{value}}</div>
			{{/allprops() name}}
		</div>
		<div class="sheet-template-row">
			<div class="sheet-tags-2">DAMAGE</div>
		</div>
	</div>
</rolltemplate>




<!-- INFO ROLL TEMPLATE -->
<rolltemplate class="sheet-rolltemplate-info">
	<div class="sheet-template-container">
		<div class="sheet-header">
			{{#name}}
			<span>{{name}}</span>
			{{/name}}
		</div>
		<div class="sheet-tag">
			{{#trait}}
			<span>{{trait}}</span>
			{{/trait}}
		</div>
		<div class="sheet-desc">
			{{#desc}}
			<span>{{desc}}</span>
			{{/desc}}
		</div>

	</div>
</rolltemplate>

<!-- ATTRIBUTE ROLL TEMPLATE -->
<rolltemplate class="sheet-rolltemplate-attribute">
	<div class="sheet-template-container">
		<div class="sheet-header">
			{{#name}}
			<span>{{name}}</span>
			{{/name}}
		</div>


		<div class="sheet-template-header">
			{{#allprops() name check}}
			<div class="sheet-value">{{value}}</div>
			{{/allprops() name check}}
		</div>
		{{#check}}
		<div class="sheet-info">
			<span>{{check}}</span>
		</div>
		{{/check}}
	</div>
</rolltemplate>


<script type="text/worker">
	// Edit Button Functionality (For Primary)
	on("clicked:repeating_primaryability:edit", function() {
		getAttrs(["repeating_primaryability_abilityname", "repeating_primaryability_blockswitch", "repeating_primaryability_tagphysical", "repeating_primaryability_tagmagical", "repeating_primaryability_tagice", "repeating_primaryability_tagfire", "repeating_primaryability_tagthunder", "repeating_primaryability_tagwind", "repeating_primaryability_tagearth", "repeating_primaryability_tagwater", "repeating_primaryability_taginvoked"], function(values) {
			let name = values.repeating_primaryability_abilityname;
			let switchToggle = values.repeating_primaryability_blockswitch;
			switchToggle = 1 - switchToggle;

			// Tag Builder
			// var tags = [];
			// tags.push(values.repeating_primaryability_tagphysical, values.repeating_primaryability_tagmagical, values.repeating_primaryability_tagice, values.repeating_primaryability_tagfire, values.repeating_primaryability_tagthunder, values.repeating_primaryability_tagwind, values.repeating_primaryability_tagearth, values.repeating_primaryability_tagwater, values.repeating_primaryability_taginvoked);
			// tags = removeItemAll(tags, "0")
			// tags.unshift("Primary")
			// const tagString = tags.join(', ');

			setAttrs({
				repeating_primaryability_blockswitch: switchToggle,
				//repeating_primaryability_tags: tagString
			});
		});
	});

	// Edit Button Functionality (For Instant)
	on("clicked:repeating_instantability:edit", function() {
		getAttrs(["repeating_instantability_abilityname", "repeating_instantability_blockswitch"], function(values) {
			let name = values.repeating_instantability_abilityname;
			let switchToggle = values.repeating_instantability_blockswitch;
			switchToggle = 1 - switchToggle;
			setAttrs({
				repeating_instantability_blockswitch: switchToggle
			});
		});
	});

	// Edit Button Functionality (For Secondary)
	on("clicked:repeating_secondaryability:edit", function() {
		getAttrs(["repeating_secondaryability_abilityname", "repeating_secondaryability_blockswitch"], function(values) {
			let name = values.repeating_secondaryability_abilityname;
			let switchToggle = values.repeating_secondaryability_blockswitch;
			switchToggle = 1 - switchToggle;
			setAttrs({
				repeating_secondaryability_blockswitch: switchToggle
			});
		});
	});

	// Edit Button Functionality for Limit Break
	on("clicked:limitbreakedit", function() {
		getAttrs(["limitbreakswitch"], function(values) {
			let switchToggle = values.limitbreakswitch;
			switchToggle = 1 - switchToggle;
			setAttrs({
				limitbreakswitch: switchToggle
			});
		});
	});

	// Checkbox for Attack
	on("clicked:repeating_primaryability:attackcheckbox", function() {
		getAttrs(["repeating_primaryability_attackcheckbox"], function(values) {
			let switchToggle = values.repeating_primaryability_attackcheckbox;
			switchToggle = 1 - switchToggle;
			setAttrs({
				repeating_primaryability_attackcheckbox: switchToggle
			});
		});
	});

	// Toggle for Traits & Other Effects
	on("clicked:repeating_traits:traitedit", function() {
		getAttrs(["repeating_traits_traitswitch"], function(values) {
			let switchToggle = values.repeating_traits_traitswitch;
			switchToggle = 1 - switchToggle;
			setAttrs({
				repeating_traits_traitswitch: switchToggle
			});
		});
	});

	// On attribute change - Primary Ability
	on("change:repeating_primaryability:abilityselector", function() {
		getAttrs(["repeating_primaryability_abilityselector"], function(values) {
			let ability = values.repeating_primaryability_abilityselector;
			var newAbility;
			switch (ability) {
				case '1d20 + @{char_strength}':
					newAbility = "STR"
					break;
				case '1d20 + @{char_dexterity}':
					newAbility = "DEX"
					break;
				case '1d20 + @{char_intelligence}':
					newAbility = "INT"
					break;
				case '1d20 + @{char_mind}':
					newAbility = "MND"
					break;
				default:
					newAbility = "Special"
			}
			setAttrs({
				repeating_primaryability_abilitycheck: newAbility
			});
		});
	});

	// on Checkbox Check - Primary Ability
	on("change:repeating_primaryability:checkcheckbox", function() {
		getAttrs(["repeating_primaryability_checkcheckbox", "repeating_primaryability_abilityRollValue"], function(values) {
			let toggle = values.repeating_primaryability_checkcheckbox;
			let originalrollvalue = values.repeating_primaryability_abilityRollValue;
			console.log(originalrollvalue)
			var newrollvalue = checkboxStringEditor(toggle, originalrollvalue)

			setAttrs({
				repeating_primaryability_abilityRollValue: newrollvalue
			});
		});
	});

	// on DirectHit Check - Primary Ability
	on("change:repeating_primaryability:directhitcheckbox", function() {
		getAttrs(["repeating_primaryability_directhitcheckbox", "repeating_primaryability_abilityRollValue"], function(values) {
			let toggle = values.repeating_primaryability_directhitcheckbox;
			let originalrollvalue = values.repeating_primaryability_abilityRollValue;
			var newrollvalue = directHitStringEditor(toggle, originalrollvalue)

			setAttrs({
				repeating_primaryability_abilityRollValue: newrollvalue
			});
		});
	});

	// on Checkbox Check - Secondary Ability
	on("change:repeating_secondaryability:checkcheckbox", function() {
		getAttrs(["repeating_secondaryability_checkcheckbox", "repeating_secondaryability_abilityRollValue"], function(values) {
			let toggle = values.repeating_secondaryability_checkcheckbox;
			let originalrollvalue = values.repeating_secondaryability_abilityRollValue;
			var newrollvalue = checkboxStringEditor(toggle, originalrollvalue)

			setAttrs({
				repeating_secondaryability_abilityRollValue: newrollvalue
			});
		});
	});

	// on DirectHit Check - Secondary Ability
	on("change:repeating_secondaryability:directhitcheckbox", function() {
		getAttrs(["repeating_secondaryability_directhitcheckbox", "repeating_secondaryability_abilityRollValue"], function(values) {
			let toggle = values.repeating_secondaryability_directhitcheckbox;
			let originalrollvalue = values.repeating_secondaryability_abilityRollValue;
			var newrollvalue = directHitStringEditor(toggle, originalrollvalue)

			setAttrs({
				repeating_secondaryability_abilityRollValue: newrollvalue
			});
		});
	});

	// on Checkbox Check - Instant Ability
	on("change:repeating_instantability:checkcheckbox", function() {
		getAttrs(["repeating_instantability_checkcheckbox", "repeating_instantability_abilityRollValue"], function(values) {
			let toggle = values.repeating_instantability_checkcheckbox;
			let originalrollvalue = values.repeating_instantability_abilityRollValue;
			var newrollvalue = checkboxStringEditor(toggle, originalrollvalue)

			setAttrs({
				repeating_instantability_abilityRollValue: newrollvalue
			});
		});
	});

	// on DirectHit Check - Instant Ability
	on("change:repeating_instantability:directhitcheckbox", function() {
		getAttrs(["repeating_instantability_directhitcheckbox", "repeating_instantability_abilityRollValue"], function(values) {
			let toggle = values.repeating_instantability_directhitcheckbox;
			let originalrollvalue = values.repeating_instantability_abilityRollValue;
			var newrollvalue = directHitStringEditor(toggle, originalrollvalue)

			setAttrs({
				repeating_instantability_abilityRollValue: newrollvalue
			});
		});
	});

	// On attribute change - Secondary Ability
	on("change:repeating_secondaryability:abilityselector", function() {
		getAttrs(["repeating_secondaryability_abilityselector"], function(values) {
			let ability = values.repeating_secondaryability_abilityselector;
			var newAbility;
			switch (ability) {
				case '1d20 + @{char_strength}':
					newAbility = "STR"
					break;
				case '1d20 + @{char_dexterity}':
					newAbility = "DEX"
					break;
				case '1d20 + @{char_intelligence}':
					newAbility = "INT"
					break;
				case '1d20 + @{char_mind}':
					newAbility = "MND"
					break;
				default:
					newAbility = "Special"
			}
			setAttrs({
				repeating_secondaryability_abilitycheck: newAbility
			});
		});
	});

	// On attribute change - Instant Ability
	on("change:repeating_instantability:abilityselector", function() {
		getAttrs(["repeating_instantability_abilityselector"], function(values) {
			let ability = values.repeating_instantability_abilityselector;
			var newAbility;
			switch (ability) {
				case '1d20 + @{char_strength}':
					newAbility = "STR"
					break;
				case '1d20 + @{char_dexterity}':
					newAbility = "DEX"
					break;
				case '1d20 + @{char_intelligence}':
					newAbility = "INT"
					break;
				case '1d20 + @{char_mind}':
					newAbility = "MND"
					break;
				default:
					newAbility = "Special"
			}
			setAttrs({
				repeating_instantability_abilitycheck: newAbility
			});
		});
	});

	const buttonlist = ["character","abilities"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });

	function removeItemAll(arr, value) {
	  var i = 0;
	  while (i < arr.length) {
	    if (arr[i] === value) {
	      arr.splice(i, 1);
	    } else {
	      ++i;
	    }
	  }
	  return arr;
	}

	function checkboxStringEditor(toggle, original) {
		var newString;

		if (toggle == "on") {
			newString = original.concat("{{check=Ability Check }}")
		} else {
			newString = original.replace("{{check=Ability Check }}", "")
		}

		return newString;
	}

	function directHitStringEditor(toggle, original) {
		var newString;

		if (toggle == "on") {
			newString = original.concat("{{directdamage=[ROLL DIRECT HIT](~repeating_primaryability_directDamageRoll) }}")
		} else {
			newString = original.replace("{{directdamage=[ROLL DIRECT HIT](~repeating_primaryability_directDamageRoll) }}", "")
		}

		return newString;
	}
	

</script>
